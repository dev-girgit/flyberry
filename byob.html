<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flyberry Gourmet - Build your Own Basket</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;700;800&family=Nunito:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://unpkg.com/d3-annotation/dist/d3-annotation.min.js"></script>
    <script src="js/cartHandler.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-light: #f7f8fb;
            --white: #ffffff;
            --accent-blue: #374151;
            --accent-blue-light: #6b7280;
            --accent-green: #0ba76b;
            --text-primary: #1a1a1a;
            --text-secondary: #6b7280;
            --border-light: #e5e7eb;
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.06);
            --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.12);
        }

        body {
            font-family: 'Nunito', -apple-system, BlinkMacSystemFont, sans-serif;
            font-weight: 300;
            background: #ffffff;
            color: var(--text-primary);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }



        h1, h2, h3 {
            font-family: 'Baloo 2', cursive;
            font-weight: 800;
            letter-spacing: -0.02em;
        }

        .brand-header {
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: center;
            padding: 0.5rem 2rem;
            background: transparent;
            margin-bottom: 0;
        }

        .brand-logo {
            height: 117px;
            width: auto;
            object-fit: contain;
        }

        .brand-title {
            font-size: 4rem;
            color: #000000;
            font-weight: regular;
            margin: 0;
            text-align: center;
        }

        .main-title {
            font-family: 'Baloo 2', cursive;
            font-size: 3rem;
            color: #000000;
            font-weight: 525;
            margin: 0;
            margin-left: 240px;
            text-align: left;
            position: sticky;
            top: 0;
            background: #ffffff;
            z-index: 100;
            padding-top: 1rem;
            padding-bottom: 0.75rem;
        }

        .cart-logo {
            width: 200px;
            height: auto;
            object-fit: contain;
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 2000;
            margin: 0;
            display: block;
        }

        /* Main Layout - 2 column layout */
        .container {
            display: grid;
            grid-template-columns: 1fr 340px;
            gap: 1rem;
            max-width: 1800px;
            margin: 0 auto;
            padding: 1rem;
            min-height: 100vh;
        }



        /* MAIN COLUMN - Now larger for bigger images */
        .main-content {
            background: #ffffff;
            padding: 2rem 3rem;
            padding-top: 6rem;
            border-radius: 20px;
            padding-bottom: calc(25vh + 120px); /* Space for fixed cart and navigation */
        }

        /* Progress Bar */
        .progress-container {
            margin-bottom: 0;
            order: -1; /* Ensure progress appears above nav buttons */
        }

        .step-navigation .progress-container {
            margin-bottom: 0;
        }

        .progress-steps {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0;
            margin: 0;
            position: relative;
        }



        .progress-step {
            font-family: 'Nunito', -apple-system, BlinkMacSystemFont, sans-serif;
            font-size: 0.95rem;
            font-weight: 600;
            text-transform: none;
            letter-spacing: 0.3px;
            color: #6b7280;
            transition: all 0.3s ease;
            cursor: pointer;
            background: #f8f9fa;
            border: none;
            padding: 0;
            height: 50px;
            width: 160px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            clip-path: polygon(0 0, calc(100% - 25px) 0, 100% 50%, calc(100% - 25px) 100%, 0 100%);
            margin-right: -25px;
        }
        
        .progress-step:first-child {
            clip-path: polygon(0 0, calc(100% - 25px) 0, 100% 50%, calc(100% - 25px) 100%, 0 100%);
            border-radius: 25px 0 0 25px;
            margin-left: 0;
            padding-left: 10px;
        }
        

        
        .progress-step:last-child {
            clip-path: polygon(0 0, 100% 0, 100% 100%, 0 100%);
            border-radius: 0 25px 25px 0;
            margin-right: 0;
            padding-right: 10px;
        }

        .progress-step:hover {
            background: #e5e7eb;
            color: #374151;
            transform: translateY(-2px) scale(1.02);
            z-index: 8;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .progress-step.active {
            background: linear-gradient(135deg, #F4E4A6 0%, #E6D073 100%);
            color: #000000;
            font-weight: 700;
            transform: scale(1.05);
            z-index: 10;
            box-shadow: 0 8px 30px rgba(218, 165, 32, 0.4);
        }

        .progress-step.completed {
            background: linear-gradient(135deg, #DAA520 0%, #B8860B 100%);
            color: white;
            font-weight: 600;
            z-index: 5;
        }
        
        .progress-step.active:hover,
        .progress-step.completed:hover {
            transform: translateY(-2px) scale(1.05);
        }

        /* Step Content */
        .step-content {
            display: none;
        }

        .step-content.active {
            display: block;
        }

        /* Navigation Buttons */
        .step-navigation {
            position: fixed;
            bottom: calc(25vh + 20px);
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-light);
            border-radius: 25px;
            padding: 20px 30px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            z-index: 1600;
            width: 300px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .cart-nav-buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
            padding: 20px 0;
            background: transparent;
            position: sticky;
            bottom: 0;
            margin-top: auto;
        }

        .cart-nav-buttons .nav-btn {
            width: 100%;
            padding: 12px 20px;
            font-size: 0.95rem;
        }
        
        .empty-cart-message {
            text-align: center;
            padding: 30px 20px;
            color: #6b7280;
            font-style: italic;
            border: 2px dashed #e5e7eb;
            border-radius: 12px;
            margin: 20px 0;
            background: linear-gradient(135deg, #fafafa 0%, #f3f4f6 100%);
        }
        
        .empty-cart-message p {
            margin: 8px 0;
            font-size: 0.9rem;
            line-height: 1.4;
        }
        
        .empty-cart-message p:first-child {
            font-size: 1rem;
            font-weight: 600;
            color: #374151;
        }
        
        .nav-btn:disabled {
            background: #e5e7eb;
            color: #9ca3af;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .nav-btn {
            padding: 14px 35px;
            font-family: 'Nunito', -apple-system, BlinkMacSystemFont, sans-serif;
            font-size: 1rem;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-transform: uppercase;
            letter-spacing: 0.8px;
            border-radius: 50px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            position: relative;
            overflow: hidden;
        }

        .btn-back {
            background: var(--white);
            color: var(--text-primary);
            border: 2px solid var(--border-light);
        }

        .btn-back:hover {
            background: var(--white);
            border-color: var(--accent-blue);
            color: var(--accent-blue);
            transform: translateY(-2px);
        }

        .btn-next {
            background: linear-gradient(135deg, #DAA520 0%, #B8860B 100%);
            color: white;
            border: none;
            margin-left: auto;
        }

        .btn-next:hover {
            background: linear-gradient(135deg, #FFD700 0%, #DAA520 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(218, 165, 32, 0.3);
        }

        .btn-next:disabled {
            background: var(--border-light);
            color: var(--text-secondary);
            cursor: not-allowed;
            transform: none;
        }

        /* Step Layout with Sidebar */
        .step-layout {
            display: block;
            margin-left: 240px;
        }

        .filter-sidebar {
            width: 200px;
            position: fixed;
            left: 20px;
            top: 33.33%;
            transform: translateY(-50%);
            z-index: 1000;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .main-content-area {
            width: 100%;
        }

        /* Step Header Row */
        .step-header-row {
            display: flex;
            justify-content: flex-start;
            align-items: center;
            margin-bottom: 2.5rem;
            position: sticky;
            top: 5rem;
            background: #ffffff;
            z-index: 200;
            padding-top: 0.5rem;
            padding-bottom: 1rem;
        }

        .step-heading {
            margin: 0;
            font-family: 'Nunito', sans-serif;
        }

        /* Gradient Text Animation */
        .gradient-animate {
            background: linear-gradient(90deg, #B8860B, #DAA520, #8B6914, #DAA520, #B8860B);
            background-size: 200% 100%;
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: gradientShift 15s ease-in-out infinite;
        }

        @keyframes gradientShift {
            0% { 
                background-position: -200% 0%;
            }
            100% { 
                background-position: 200% 0%;
            }
        }

        /* Progress Pill Fill Animation */
        .progress-step {
            position: relative;
            overflow: hidden;
        }

        .progress-step.completed {
            background: linear-gradient(135deg, #DAA520 0%, #B8860B 100%);
            color: white;
            font-weight: 600;
            z-index: 5;
        }

        .progress-step::before {
            content: '';
            position: absolute;
            top: 0;
            right: 100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #DAA520 0%, #B8860B 100%);
            transition: right 0.8s ease-in-out;
            z-index: -1;
        }

        .progress-step.fill-animate::before {
            right: 0;
        }

        .progress-step.fill-animate {
            color: white !important;
            position: relative;
            z-index: 2;
        }

        /* Category Sections */
        .category-section {
            margin-bottom: 4rem;
            position: relative;
        }

        .category-section-title {
            font-family: 'Baloo 2', cursive;
            font-size: 1.5rem;
            font-weight: 700;
            color: #DAA520;
            margin-bottom: 1.5rem;
            text-align: left;
        }

        .category-section .product-card {
            display: block !important;
        }

        /* Filter Tabs */
        .filter-tabs {
            display: flex;
            flex-direction: column;
            gap: 12px;
            justify-content: flex-start;
            align-items: stretch;
        }

        .filter-tab {
            padding: 12px 20px;
            font-size: 0.95rem;
            font-weight: 600;
            font-family: 'Nunito', -apple-system, BlinkMacSystemFont, sans-serif;
            background: white;
            border: 2px solid #efdba7;
            color: #000000;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 25px;
            position: relative;
            white-space: nowrap;
            text-align: center;
            width: 100%;
        }

        .filter-tab:hover {
            background: linear-gradient(135deg, #FFD700 0%, #DAA520 100%);
            border-color: #DAA520;
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(218, 165, 32, 0.3);
        }

        .filter-tab.active {
            background: linear-gradient(135deg, #DAA520 0%, #B8860B 100%);
            border-color: #B8860B;
            color: white;
            font-weight: 700;
            transform: translateY(-1px);
            box-shadow: 0 2px 12px rgba(218, 165, 32, 0.5);
        }

        /* Category Sections */
        .category-section {
            margin-bottom: 4rem;
        }

        .category-section-title {
            font-family: 'Baloo 2', cursive;
            font-size: 1.8rem;
            font-weight: 700;
            color: #DAA520;
            margin-bottom: 3rem;
            text-align: left;
            border-bottom: 2px solid #DAA520;
            padding-bottom: 0.5rem;
            position: sticky;
            top: 8.5rem;
            background: #ffffff;
            z-index: 50;
            margin-top: 0;
            padding-top: 0.25rem;
        }

        .category-items {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 2.5rem 2rem;
            padding-bottom: 2rem;
        }

        /* Special layouts for single-line sections */
        .category-items.chips-layout,
        .category-items.gifting-layout {
            grid-template-columns: repeat(4, 1fr);
            gap: 1.5rem;
        }

        /* Smaller image scaling for chips and gifting sections */
        .chips-layout .product-image-wrapper,
        .gifting-layout .product-image-wrapper {
            transform: scale(0.95);
        }

        .chips-layout .product-card,
        .gifting-layout .product-card {
            margin-bottom: 1rem;
        }

        /* Product grid for non-categorized steps (nets, ribbons) */
        .step-content[data-step="2"] .product-grid,
        .step-content[data-step="3"] .product-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 2.5rem 2rem;
            padding-top: 1rem;
        }

        /* Product Grid - Now with more space for larger images */
        .product-grid {
            display: block;
        }

        .product-card {
            position: relative;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .product-card:hover {
            transform: translateY(-8px);
        }

        .product-card.selected .product-image-wrapper {
            border-color: var(--accent-blue);
            border-width: 2px;
        }

        .product-image-wrapper {
            width: 100%;
            aspect-ratio: 1;
            background: transparent;
            border: none;
            overflow: hidden;
            margin-bottom: 0.25rem;
            position: relative;
            border-radius: 15px;
        }



        .product-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .product-card:hover .product-image {
            transform: scale(1.08);
        }

        .product-info {
            text-align: center;
        }

        .product-name {
            font-weight: 600;
            font-size: 1rem;
            margin-bottom: 0.25rem;
            color: var(--text-primary);
        }

        .product-price {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .product-add-indicator {
            position: absolute;
            top: 0.75rem;
            right: 0.75rem;
            width: 36px;
            height: 36px;
            background: var(--accent-blue);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            opacity: 0;
            transform: scale(0.8);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }



        .product-card.selected .product-add-indicator {
            opacity: 1;
            transform: scale(1);
            background: var(--accent-green);
        }

        .product-card.selected .product-add-indicator::after {
            content: 'âœ“';
            font-size: 20px;
        }

        .product-card.selected .product-add-indicator::before {
            content: '';
            display: none;
        }

        .product-counter, .basket-counter {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #ef4444;
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            z-index: 10;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }



        /* Basket counter badge */
        .basket-counter {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #DAA520;
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            animation: bounceIn 0.5s ease-out;
        }

        @keyframes bounceIn {
            0% { transform: scale(0); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        /* RIGHT COLUMN - Cart */
        .cart-summary {
            position: fixed;
            bottom: 0;
            right: 0;
            width: 340px;
            height: 25vh;
            background: var(--white);
            padding: 0.5rem;
            border-radius: 20px 20px 0 0;
            display: flex;
            flex-direction: column;
            z-index: 1500;
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border-light);
        }

        .cart-content {
            flex: 1;
            overflow-y: auto;
            padding-right: 20px;
            margin-bottom: 1rem;
            padding-bottom: 30px;
            margin-right: -8px;
        }

        .cart-content::-webkit-scrollbar {
            width: 8px;
        }

        .cart-content::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }

        .cart-content::-webkit-scrollbar-thumb {
            background: #d1d5db;
            border-radius: 3px;
        }

        .cart-content::-webkit-scrollbar-thumb:hover {
            background: #9ca3af;
        }

        .cart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            border-bottom: 2px solid var(--border-light);
            padding-bottom: 1rem;
        }

        .cart-title {
            font-family: 'Baloo 2', cursive;
            font-weight: 700;
            font-size: 1.25rem;
            margin: 0;
        }

        .cart-toggle-btn {
            background: transparent;
            border: 2px solid var(--border-light);
            border-radius: 50%;
            width: 36px;
            height: 36px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            color: var(--text-secondary);
        }

        .cart-toggle-btn:hover {
            background: var(--accent-blue);
            border-color: var(--accent-blue);
            color: white;
            transform: scale(1.1);
        }

        .cart-toggle-btn svg {
            transition: transform 0.3s ease;
        }

        .cart-summary.expanded .cart-toggle-btn svg {
            transform: rotate(180deg);
        }

        /* Cart States */
        .cart-summary {
            transition: height 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .cart-summary.expanded {
            height: 50vh;
        }

        .step-navigation {
            transition: bottom 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .cart-summary.expanded ~ .container .step-navigation,
        body.cart-expanded .step-navigation {
            bottom: calc(50vh + 20px);
        }

        /* Desktop main content padding for expanded state */
        body.cart-expanded .main-content {
            padding-bottom: calc(50vh + 120px);
        }

        .cart-section {
            margin-bottom: 1.5rem;
        }

        .cart-section-title {
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-secondary);
            margin-bottom: 0.75rem;
        }

        .cart-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-light);
        }

        .cart-item:last-child {
            border-bottom: none;
        }

        .cart-item-image {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border: 1px solid var(--border-light);
        }

        .cart-item-info {
            flex: 1;
        }

        .cart-item-name {
            font-size: 0.875rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .cart-item-price {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .cart-item-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .quantity-btn {
            width: 30px;
            height: 30px;
            border: 1px solid var(--border-light);
            background: var(--white);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .quantity-btn:hover {
            background: var(--accent-blue);
            color: var(--white);
            border-color: var(--accent-blue);
        }

        .quantity-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .quantity-btn[title*="Remove"] {
            background: var(--white);
            border-color: var(--border-light);
            color: var(--text-dark);
        }

        .quantity-btn[title*="Remove"]:hover {
            background: var(--accent-blue);
            border-color: var(--accent-blue);
            color: var(--white);
        }



        .quantity-display {
            font-weight: bold;
            min-width: 30px;
            text-align: center;
            font-size: 0.9rem;
        }

        .cart-item-total {
            font-weight: bold;
            color: var(--accent-blue);
            font-size: 1rem;
            margin-left: auto;
            padding-left: 1rem;
        }

        .cart-btn {
            width: 32px;
            height: 32px;
            background: var(--text-primary);
            color: white;
            border: none;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .cart-btn:hover {
            background: var(--accent-blue);
            transform: scale(1.1);
        }

        .cart-btn:active {
            transform: scale(0.95);
        }

        .cart-quantity {
            font-weight: 700;
            font-size: 0.9rem;
            min-width: 24px;
            text-align: center;
        }

        .cart-total {
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 2px solid var(--border-light);
        }

        .cart-subtotal, .cart-discount, .cart-final-total {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .cart-subtotal-label, .cart-discount-label, .cart-total-label {
            font-size: 0.875rem;
            font-weight: 600;
        }

        .cart-subtotal-price, .cart-discount-price {
            font-size: 0.875rem;
            font-weight: 500;
        }

        .cart-discount {
            color: #0ba76b;
            font-weight: 600;
        }

        .cart-final-total {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-light);
        }

        .cart-total-label {
            font-size: 1rem;
            font-weight: 700;
        }

        .cart-total-price {
            font-family: 'Baloo 2', cursive;
            font-size: 1.2rem;
            font-weight: 700;
            color: #DAA520;
        }

        .cart-empty {
            text-align: center;
            color: var(--text-secondary);
            font-size: 0.875rem;
            padding: 1rem 0;
        }

        /* Save Cart Button */
        .save-cart-btn {
            width: 100%;
            padding: 12px 20px;
            background: var(--accent-green);
            color: white;
            border: none;
            border-radius: 8px;
            font-family: 'Nunito', sans-serif;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .save-cart-btn:hover {
            background: #0a9960;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(11, 167, 107, 0.3);
        }

        .save-cart-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .save-cart-btn .save-icon {
            width: 16px;
            height: 16px;
        }

        /* Save Cart Button */
        .save-cart-btn {
            width: 100%;
            padding: 12px 20px;
            background: var(--accent-green);
            color: white;
            border: none;
            border-radius: 8px;
            font-family: 'Nunito', sans-serif;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .save-cart-btn:hover {
            background: #0a9960;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(11, 167, 107, 0.3);
        }

        .save-cart-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .save-cart-btn .save-icon {
            width: 16px;
            height: 16px;
        }

        /* Checkout Summary */
        .summary-section {
            margin-bottom: 2rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid var(--border-light);
        }

        .summary-section:last-of-type {
            border-bottom: none;
        }

        .summary-section h3 {
            font-size: 1.125rem;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            font-size: 0.9rem;
            padding: 0.75rem;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 8px;
            border: 1px solid var(--border-light);
        }

        .summary-item-info {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex: 1;
        }

        .summary-item-image {
            width: 50px;
            height: 50px;
            object-fit: cover;
            border-radius: 6px;
            border: none;
        }

        .summary-item-details {
            flex: 1;
        }

        .summary-item-label {
            color: var(--text-primary);
            font-weight: 500;
            margin-bottom: 0.25rem;
        }

        .summary-item-quantity {
            color: var(--text-secondary);
            font-size: 0.8rem;
        }

        .summary-item-value {
            font-weight: 700;
            color: var(--text-primary);
        }

        .summary-section {
            margin-bottom: 2rem;
        }

        .summary-section h3 {
            margin-bottom: 1rem;
            color: var(--text-primary);
            font-weight: 700;
        }

        .basket-arrangement {
            position: relative;
            width: 800px;
            height: 500px;
            margin: 3rem auto;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .center-basket {
            width: 200px;
            height: 200px;
            object-fit: cover;
            z-index: 2;
            cursor: pointer;
            position: absolute;
            bottom: 50px;
            left: 50%;
            transform: translateX(-50%);
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .center-basket:hover {
            transform: translateX(-50%);
        }

        .circular-items {
            position: absolute;
            width: 100%;
            height: 50%;
            top: 0;
        }

        .item-circle {
            position: absolute;
            width: 156px;
            height: 156px;
            object-fit: cover;
            transition: transform 0.3s ease;
            cursor: pointer;
        }

        .item-circle:hover {
            transform: none;
        }

        .summary-totals {
            background: rgba(255, 255, 255, 0.9);
            padding: 1.5rem;
            border-radius: 12px;
            border: 2px solid #DAA520;
            margin-top: 2rem;
        }

        .baskets-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .individual-basket {
            background: var(--white);
            padding: 1.5rem;
            border-radius: 15px;
            box-shadow: var(--shadow-md);
            border: 2px solid var(--border-light);
        }

        .individual-basket h4 {
            text-align: center;
            margin-bottom: 1rem;
            color: var(--text-primary);
            font-size: 1.1rem;
        }

        .net-item {
            border: 3px solid #3b82f6 !important;
            border-radius: 50%;
        }

        .ribbon-item {
            border: 3px solid #ec4899 !important;
            border-radius: 50%;
        }

        .total-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .discount-row {
            color: #0ba76b !important;
            font-weight: 600 !important;
        }

        .final-total {
            display: flex;
            justify-content: space-between;
            font-size: 1.25rem;
            font-weight: 700;
            color: #DAA520;
            border-top: 2px solid #DAA520;
            padding-top: 1rem;
            margin-top: 1rem;
        }

        /* Go to Top Button */
        .go-to-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #DAA520 0%, #B8860B 100%);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transform: translateY(20px);
        }

        .go-to-top.visible {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .go-to-top:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
            background: linear-gradient(135deg, #FFD700 0%, #DAA520 100%);
        }

        .go-to-top:active {
            transform: translateY(-1px);
        }

        @media (max-width: 1400px) {
            .container {
                grid-template-columns: 1fr 320px;
                gap: 0.8rem;
            }

            .main-content {
                padding: 2rem 2.5rem;
            }
        }

        @media (max-width: 1280px) {
            .container {
                grid-template-columns: 1fr 300px;
                gap: 0.6rem;
                padding: 1rem;
            }

            .main-content {
                padding: 2rem;
            }
        }

        @media (max-width: 1024px) {
            .container {
                grid-template-columns: 1fr;
            }

            .cart-summary {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                width: 100vw;
                height: 20vh;
                border-radius: 20px 20px 0 0;
            }

            .cart-summary.expanded {
                height: 40vh;
            }

            .step-navigation {
                bottom: calc(20vh + 20px);
                right: 20px;
                left: 20px;
                width: auto;
            }

            body.cart-expanded .step-navigation {
                bottom: calc(40vh + 20px);
            }

            .category-items,
            .step-content[data-step="2"] .product-grid,
            .step-content[data-step="3"] .product-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            /* Keep chips and gifting as 4 columns on tablet */
            .category-items.chips-layout,
            .category-items.gifting-layout {
                grid-template-columns: repeat(4, 1fr);
                gap: 1rem;
            }
        }

        @media (max-width: 640px) {
            .brand-title {
                font-size: 2.8rem;
            }

            .brand-header {
                flex-direction: column;
                gap: 0.5rem;
                padding: 1rem;
            }

            .brand-logo {
                height: 52px;
            }

            .main-content {
                padding: 2rem 1.5rem;
                padding-bottom: calc(20vh + 120px);
            }

            body.cart-expanded .main-content {
                padding-bottom: calc(40vh + 120px);
            }

            .category-items,
            .step-content[data-step="2"] .product-grid,
            .step-content[data-step="3"] .product-grid {
                grid-template-columns: 1fr;
                gap: 2rem;
            }

            /* Mobile: chips and gifting as 2 columns */
            .category-items.chips-layout,
            .category-items.gifting-layout {
                grid-template-columns: repeat(2, 1fr);
                gap: 1.5rem;
            }

            .step-navigation {
                bottom: calc(20vh + 15px);
                padding: 15px 20px;
                left: 20px;
                right: 20px;
                width: auto;
            }

            body.cart-expanded .step-navigation {
                bottom: calc(40vh + 15px);
            }

            .nav-buttons {
                flex-direction: column;
                gap: 1rem;
            }

            .progress-steps {
                flex-wrap: wrap;
                justify-content: center;
                gap: 5px;
            }
            
            .progress-step {
                min-width: 120px;
                height: 45px;
                font-size: 0.85rem;
                margin-right: -15px;
            }
            
            .progress-step:first-child,
            .progress-step:last-child {
                margin-right: 0;
            }

            .btn-next {
                max-width: 100%;
            }
        }

        /* Tooltip Styles */
        .product-tooltip {
            position: fixed;
            background: var(--white);
            border-radius: 20px;
            box-shadow: var(--shadow-lg);
            padding: 0;
            z-index: 10000;
            width: 75vw;
            height: 85vh;
            max-width: 95vw;
            max-height: 95vh;
            opacity: 0;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%) scale(0.8);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: none;
            border: 1px solid var(--border-light);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* Mobile: Additional mobile-specific adjustments */
        @media (max-width: 768px) {
            .product-tooltip {
                width: 90vw;
                height: 90vh;
                max-width: 90vw;
                max-height: 90vh;
            }
        }

        .product-tooltip.visible {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
            pointer-events: auto;
        }

        .tooltip-header {
            position: relative;
            padding: 0;
            margin: 0;
            flex-shrink: 0;
            width: 100%;
            height: 50%;
        }

        /* Mobile: Additional header adjustments */
        @media (max-width: 768px) {
            .tooltip-header {
                height: 45%;
            }
        }

        .image-carousel {
            position: relative;
            width: 100%;
            height: 100%;
        }

        .carousel-container {
            position: relative;
            width: 100%;
            height: 100%;
            overflow: hidden;
            border-radius: 20px 20px 0 0;
        }

        .tooltip-image {
            width: 100%;
            height: 100%;
            object-fit: contain;
            object-position: center;
            position: absolute;
            top: 0;
            left: 0;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }

        .tooltip-image.active {
            opacity: 1;
        }

        .carousel-arrow {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.6);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .carousel-arrow:hover {
            background: rgba(0, 0, 0, 0.8);
            transform: translateY(-50%) scale(1.1);
        }

        .carousel-prev {
            left: 12px;
        }

        .carousel-next {
            right: 12px;
        }

        .carousel-dots {
            position: absolute;
            bottom: 16px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 8px;
            background: rgba(0, 0, 0, 0.5);
            padding: 8px 16px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }

        .carousel-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            padding: 0;
        }

        .carousel-dot:hover {
            background: rgba(255, 255, 255, 0.7);
            transform: scale(1.2);
        }

        .carousel-dot.active {
            background: white;
            transform: scale(1.3);
        }

        .carousel-dots.hidden {
            display: none;
        }

        .tooltip-close {
            position: absolute;
            top: 12px;
            right: 12px;
            width: 32px;
            height: 32px;
            background: transparent;
            color: black;
            border: 2px solid black;
            border-radius: 50%;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            z-index: 10001;
            z-index: 10001;
        }

        .tooltip-close:hover {
            background: black;
            color: white;
            transform: scale(1.1);
        }

        .tooltip-content {
            padding: 32px;
            flex: 1;
            overflow-y: auto;
            max-height: none;
            width: 100%;
            height: 50%;
            display: flex;
            flex-direction: column;
        }

        /* Mobile: Content adjustments */
        @media (max-width: 768px) {
            .tooltip-content {
                height: 55%;
                padding: 20px;
            }
        }

        .tooltip-header-info {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
            gap: 16px;
        }

        .tooltip-title {
            font-family: 'Baloo 2', cursive;
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0;
            line-height: 1.2;
            flex: 1;
        }

        .tooltip-description {
            color: var(--text-secondary);
            font-size: 1.1rem;
            line-height: 1.5;
            margin-bottom: 20px;
        }

        .tooltip-price {
            font-family: 'Baloo 2', cursive;
            font-size: 2rem;
            font-weight: 800;
            color: var(--accent-blue);
            margin: 0;
            flex-shrink: 0;
        }

        .tooltip-variants {
            margin-bottom: 28px;
        }

        .tooltip-variants-title {
            font-weight: 600;
            font-size: 1rem;
            color: var(--text-primary);
            margin-bottom: 16px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .variant-options {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }

        .variant-option {
            padding: 12px 20px;
            background: var(--bg-light);
            border: 1px solid var(--border-light);
            border-radius: 10px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            user-select: none;
            min-height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .variant-option:hover {
            border-color: var(--accent-blue);
            background: rgba(11, 116, 222, 0.1);
        }

        .variant-option.selected {
            background: var(--accent-blue);
            color: white;
            border-color: var(--accent-blue);
        }

        .tooltip-actions {
            display: flex;
            gap: 16px;
            margin-top: 8px;
        }

        .tooltip-btn {
            flex: 1;
            padding: 16px 32px;
            border: none;
            border-radius: 12px;
            font-family: 'Baloo 2', cursive;
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            min-height: 56px;
        }

        .tooltip-btn-primary {
            background: var(--accent-blue);
            color: white;
        }

        .tooltip-btn-primary:hover {
            background: var(--accent-blue-light);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .tooltip-btn-secondary {
            background: var(--bg-light);
            color: var(--text-primary);
            border: 1px solid var(--border-light);
        }

        .tooltip-btn-secondary:hover {
            border-color: var(--accent-blue);
            color: var(--accent-blue);
        }

        /* D3 Annotation Styles */
        .annotation {
            pointer-events: none;
        }

        .annotation-note {
            fill: var(--text-primary);
            font-size: 14px;
            font-family: 'Nunito', sans-serif;
        }

        .annotation-connector {
            stroke: var(--accent-blue);
            stroke-width: 2px;
            fill: none;
        }

        .annotation-subject {
            stroke: var(--accent-blue);
            stroke-width: 2px;
            fill: var(--accent-blue);
        }

        /* Overlay for tooltip background */
        .tooltip-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.3);
            z-index: 9999;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .tooltip-overlay.visible {
            opacity: 1;
            pointer-events: auto;
        }

        /* Loading Popup Styles */
        .loading-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 20px;
            padding: 3rem 2.5rem;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            text-align: center;
            min-width: 400px;
            max-width: 500px;
        }

        .loading-popup.visible {
            opacity: 1;
            visibility: visible;
        }

        .loading-popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 9998;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease;
        }

        .loading-popup-overlay.visible {
            opacity: 1;
            visibility: visible;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            margin: 0 auto 2rem;
            border: 4px solid #f3f4f6;
            border-top: 4px solid #DAA520;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-title {
            font-family: 'Baloo 2', cursive;
            font-size: 1.8rem;
            font-weight: 700;
            color: #1a1a1a;
            margin-bottom: 1rem;
        }

        .loading-message {
            font-size: 1rem;
            color: #6b7280;
            margin-bottom: 1.5rem;
            line-height: 1.5;
        }

        .loading-progress {
            background: #f3f4f6;
            height: 6px;
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 1rem;
        }

        .loading-progress-bar {
            background: linear-gradient(90deg, #DAA520, #FFD700);
            height: 100%;
            border-radius: 3px;
            width: 0%;
            transition: width 0.3s ease;
        }

        .loading-status {
            font-size: 0.875rem;
            color: #059669;
            font-weight: 600;
        }

        @media (max-width: 640px) {
            .loading-popup {
                min-width: 320px;
                max-width: 90vw;
                padding: 2rem 1.5rem;
            }
            
            .loading-title {
                font-size: 1.5rem;
            }
        }

        /* Tablet: Adjust sidebar for medium screens */
        @media (max-width: 1024px) and (min-width: 769px) {
            .filter-sidebar {
                width: 160px;
                left: 15px;
                padding: 15px;
            }

            .step-layout {
                margin-left: 190px;
            }

            .main-title {
                margin-left: 190px;
            }

            .filter-tab {
                padding: 10px 16px;
                font-size: 0.9rem;
            }

            .cart-logo {
                left: 15px;
                width: 160px;
                height: auto;
            }
        }

        /* Large screens: Enhanced center-left positioning */
        @media (min-width: 1200px) {
            .filter-sidebar {
                width: 220px;
                left: 30px;
                padding: 25px;
            }

            .step-layout {
                margin-left: 270px;
            }

            .main-title {
                margin-left: 270px;
            }

            .cart-logo {
                left: 30px;
                width: 220px;
                height: auto;
            }
        }

        /* Optimized for 46:27 aspect ratio (narrow portrait screens ~360-430px width) */
        @media (max-width: 430px) and (min-aspect-ratio: 1/2) {
            .brand-title {
                font-size: 2.2rem;
                line-height: 1.1;
            }

            .brand-header {
                padding: 0.75rem;
                gap: 0.25rem;
            }

            .brand-logo {
                height: 45px;
            }

            .main-content {
                padding: 1.5rem 1rem;
            }

            .main-title {
                font-size: 2rem;
                margin-bottom: 1.5rem;
            }

            .step-heading {
                font-size: 1.5rem;
            }

            /* Mobile: Revert to horizontal layout */
            .step-layout {
                margin-left: 0;
                display: flex;
                flex-direction: column;
            }

            .main-title {
                margin-left: 0;
            }

            .cart-logo {
                position: static;
                left: auto;
                top: auto;
                width: auto;
                height: 60px;
                display: block;
                margin: 0 auto 1rem auto;
            }

            .main-content {
                padding-top: 2rem;
            }

            .main-content-area {
                order: 1;
            }

            .filter-sidebar {
                position: static;
                width: 100%;
                left: auto;
                top: auto;
                transform: none;
                margin-bottom: 1.5rem;
                background: white;
                backdrop-filter: none;
                border-radius: 15px;
                padding: 15px;
                box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
                order: 2;
            }

            .filter-tabs {
                flex-direction: row;
                flex-wrap: wrap;
                gap: 0.5rem;
                justify-content: center;
            }

            .filter-tab {
                padding: 0.5rem 1rem;
                font-size: 0.85rem;
                min-width: auto;
                width: auto;
            }

            .category-items {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }

            .category-items.chips-layout,
            .category-items.gifting-layout {
                grid-template-columns: 1fr;
                gap: 1.25rem;
            }

            .product-card {
                padding: 1rem;
            }

            .product-image {
                width: 120px;
                height: 120px;
            }

            .product-title {
                font-size: 1.1rem;
            }

            .product-price {
                font-size: 1rem;
            }

            .step-navigation {
                bottom: 15px;
                padding: 12px 15px;
                max-width: 96vw;
            }

            .progress-steps {
                gap: 3px;
            }

            .progress-step {
                min-width: 100px;
                height: 40px;
                font-size: 0.75rem;
                margin-right: -12px;
            }

            .btn-next, .btn-back {
                padding: 10px 20px;
                font-size: 0.9rem;
            }

            .product-tooltip {
                width: 90vw;
                height: 85vh;
                max-width: 90vw;
                max-height: 85vh;
                flex-direction: column;
            }

            .tooltip-header {
                width: 100%;
                height: 45%;
                flex-shrink: 0;
            }

            .carousel-container {
                border-radius: 20px 20px 0 0;
            }

            .tooltip-content {
                width: 100%;
                height: 55%;
                padding: 1rem;
                overflow-y: auto;
            }

            .tooltip-header-info {
                margin-bottom: 12px;
                gap: 12px;
                flex-wrap: wrap;
            }

            .tooltip-title {
                font-size: 1.25rem;
            }

            .tooltip-description {
                font-size: 0.9rem;
                margin-bottom: 16px;
            }

            .tooltip-price {
                font-size: 1.5rem;
            }
        }

        /* Extra narrow screens (â‰¤360px) */
        @media (max-width: 360px) {
            .brand-title {
                font-size: 1.8rem;
            }

            .main-title {
                font-size: 1.75rem;
            }

            .filter-tab {
                padding: 0.4rem 0.8rem;
                font-size: 0.8rem;
                width: auto;
            }

            .product-card {
                padding: 0.75rem;
            }

            .product-image {
                width: 100px;
                height: 100px;
            }

            .product-title {
                font-size: 1rem;
            }

            .product-price {
                font-size: 0.9rem;
            }

            .progress-step {
                min-width: 85px;
                height: 36px;
                font-size: 0.7rem;
                margin-right: -10px;
            }

            .btn-next, .btn-back {
                padding: 8px 16px;
                font-size: 0.85rem;
            }

            /* Tooltip adjustments for very narrow screens */
            .product-tooltip {
                width: 95vw;
                height: 90vh;
                max-width: 95vw;
                max-height: 90vh;
            }

            .tooltip-header {
                height: 40%;
            }

            .tooltip-content {
                height: 60%;
                padding: 0.75rem;
            }

            .tooltip-header-info {
                margin-bottom: 10px;
                gap: 8px;
                flex-direction: column;
                align-items: flex-start;
            }

            .tooltip-title {
                font-size: 1.1rem;
            }

            .tooltip-description {
                font-size: 0.85rem;
                margin-bottom: 12px;
            }

            .tooltip-price {
                font-size: 1.3rem;
            }

            .tooltip-actions {
                gap: 8px;
            }

            .tooltip-btn {
                padding: 8px 16px;
                font-size: 0.85rem;
            }
        }

        /* Toast Notification Styles */
        .toast-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #0ba76b;
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(11, 167, 107, 0.3);
            font-weight: 600;
            font-size: 0.9rem;
            z-index: 10000;
            transform: translateX(100%);
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            max-width: 300px;
            border-left: 4px solid #059669;
        }

        .toast-notification.show {
            transform: translateX(0);
            opacity: 1;
        }

        .toast-notification.success {
            background: #0ba76b;
            border-left-color: #059669;
        }

        .toast-notification.info {
            background: #3b82f6;
            border-left-color: #2563eb;
        }

        .toast-notification::before {
            content: "âœ“";
            display: inline-block;
            margin-right: 8px;
            font-weight: bold;
            font-size: 1.1rem;
        }

        @media (max-width: 768px) {
            .toast-notification {
                top: 10px;
                right: 10px;
                left: 10px;
                transform: translateY(-100%);
                max-width: none;
            }

            .toast-notification.show {
                transform: translateY(0);
            }
        }
    </style>
</head>
<body>
    <!-- Tooltip Overlay -->
    <div class="tooltip-overlay" id="tooltipOverlay" onclick="hideTooltip()"></div>
    
    <!-- Toast Notification -->
    <div class="toast-notification" id="toastNotification"></div>
    
    <!-- Loading Popup Overlay -->
    <div class="loading-popup-overlay" id="loadingOverlay"></div>
    
    <!-- Loading Popup -->
    <div class="loading-popup" id="loadingPopup">
        <div class="loading-spinner"></div>
        <h2 class="loading-title">Processing Your Order</h2>
        <p class="loading-message">Please wait while we save your beautiful gift basket...</p>
        <div class="loading-progress">
            <div class="loading-progress-bar" id="loadingProgressBar"></div>
        </div>
        <div class="loading-status" id="loadingStatus">Processing your order...</div>
    </div>
    
    <!-- Product Tooltip -->
    <div class="product-tooltip" id="productTooltip">
        <button class="tooltip-close" onclick="hideTooltip()">Ã—</button>
        <div class="tooltip-header">
            <div class="image-carousel">
                <div class="carousel-container" id="carouselContainer">
                    <img class="tooltip-image active" id="tooltipImage" src="" alt="">
                    <button class="carousel-arrow carousel-prev" onclick="prevImage()" style="display: none;">â€¹</button>
                    <button class="carousel-arrow carousel-next" onclick="nextImage()" style="display: none;">â€º</button>
                </div>
                <div class="carousel-dots" id="carouselDots">
                    <!-- Dots will be added dynamically -->
                </div>
            </div>
        </div>
        <div class="tooltip-content">
            <div class="tooltip-header-info">
                <h3 class="tooltip-title" id="tooltipTitle"></h3>
                <div class="tooltip-price" id="tooltipPrice"></div>
            </div>
            <p class="tooltip-description" id="tooltipDescription"></p>
            
            <div class="tooltip-variants" id="tooltipVariants" style="display: none;">
                <div class="tooltip-variants-title">Available Variants</div>
                <div class="variant-options" id="variantOptions"></div>
            </div>
            
            <div class="tooltip-actions">
                <button class="tooltip-btn tooltip-btn-secondary" onclick="hideTooltip()">Close</button>
                <button class="tooltip-btn tooltip-btn-primary" id="addToBasketBtn" onclick="addFromTooltip()">Add to Basket</button>
            </div>
        </div>
    </div>

    <!-- Go to Top Button -->
    <button class="go-to-top" id="goToTopBtn" onclick="scrollToTop()" aria-label="Go to top">
        â†‘
    </button>

    <!-- Same HTML as before - keeping it identical -->
    <div class="container">        
        <!-- MAIN CONTENT -->
        <main class="main-content">
            <h1 class="main-title">Build Your Own Basket</h1>
            
            <!-- STEP 1: Items Selection -->
            <div class="step-content active" data-step="0">
                <div class="step-layout">
                    <!-- Left Sidebar with Filters -->
                    <div class="filter-sidebar">
                        <div class="filter-tabs">
                            <button class="filter-tab active" data-filter="dates">Dates</button>
                            <button class="filter-tab" data-filter="nuts">Nuts</button>
                            <button class="filter-tab" data-filter="chips">Chips</button>
                            <button class="filter-tab" data-filter="gifting">Gifting</button>
                        </div>
                    </div>
                    
                    <!-- Main Content Area -->
                    <div class="main-content-area">
                        <div class="step-header-row">
                            <h2 class="step-heading" id="step1Heading">Step 1: Choose your items</h2>
                        </div>

                        <div class="product-grid" id="itemsGrid">
                    <!-- Dates Section -->
                    <div class="category-section" id="dates-section">
                        <h3 class="category-section-title">Dates</h3>
                        <div class="category-items">
                            <div class="product-card" data-type="item" data-category="dates" data-product="Date Bite" data-price="399">
                                <div class="product-image-wrapper">
                                    <img src="DATES/DATE BITE/1.png" alt="Date Bite" class="product-image">
                                    <div class="product-add-indicator">+</div>
                                </div>
                                <div class="product-info">
                                    <div class="product-name">Date Bite</div>
                                    <div class="product-price">â‚¹399</div>
                                </div>
                            </div>

                            <div class="product-card" data-type="item" data-category="dates" data-product="Mini Medjoul" data-price="499">
                                <div class="product-image-wrapper">
                                    <img src="DATES/MINI MEDJOUL/1.png" alt="Mini Medjoul" class="product-image">
                                    <div class="product-add-indicator">+</div>
                                </div>
                                <div class="product-info">
                                    <div class="product-name">Mini Medjoul</div>
                                    <div class="product-price">â‚¹499</div>
                                </div>
                            </div>

                            <div class="product-card" data-type="item" data-category="dates" data-product="Deri Dates" data-price="249">
                                <div class="product-image-wrapper">
                                    <img src="DATES/DERI/DERI 250 g/1.png" alt="Deri Dates" class="product-image">
                                    <div class="product-add-indicator">+</div>
                                </div>
                                <div class="product-info">
                                    <div class="product-name">Deri Dates</div>
                                    <div class="product-price">â‚¹249</div>
                                </div>
                            </div>

                            <div class="product-card" data-type="item" data-category="dates" data-product="Deglet Dates" data-price="399">
                                <div class="product-image-wrapper">
                                    <img src="DATES/DEGLET/1.png" alt="Deglet Dates" class="product-image">
                                    <div class="product-add-indicator">+</div>
                                </div>
                                <div class="product-info">
                                    <div class="product-name">Deglet Dates</div>
                                    <div class="product-price">â‚¹399</div>
                                </div>
                            </div>

                            <div class="product-card" data-type="item" data-category="dates" data-product="Kalmi Dates" data-price="399">
                                <div class="product-image-wrapper">
                                    <img src="DATES/KALMI/1.png" alt="Kalmi Dates" class="product-image">
                                    <div class="product-add-indicator">+</div>
                                </div>
                                <div class="product-info">
                                    <div class="product-name">Kalmi Dates</div>
                                    <div class="product-price">â‚¹399</div>
                                </div>
                            </div>

                            <div class="product-card" data-type="item" data-category="dates" data-product="Ameri Dates" data-price="299">
                                <div class="product-image-wrapper">
                                    <img src="DATES/AMERI/1.png" alt="Ameri Dates" class="product-image">
                                    <div class="product-add-indicator">+</div>
                                </div>
                                <div class="product-info">
                                    <div class="product-name">Ameri Dates</div>
                                    <div class="product-price">â‚¹299</div>
                                </div>
                            </div>

                            <!-- Placeholder for future products -->

                            <div class="product-card" data-type="item" data-category="dates" data-product="Hazelnut Chocolate Spread" data-price="299">
                                <div class="product-image-wrapper">
                                    <img src="DATES/6.png" alt="Hazelnut Chocolate Spread" class="product-image">
                                    <div class="product-add-indicator">+</div>
                                </div>
                                <div class="product-info">
                                    <div class="product-name">Hazelnut Chocolate Spread</div>
                                    <div class="product-price">â‚¹299</div>
                                </div>
                            </div>

                            <div class="product-card" data-type="item" data-category="dates" data-product="Date Powder" data-price="99">
                                <div class="product-image-wrapper">
                                    <img src="DATES/8.png" alt="Date Powder" class="product-image">
                                    <div class="product-add-indicator">+</div>
                                </div>
                                <div class="product-info">
                                    <div class="product-name">Date Powder</div>
                                    <div class="product-price">â‚¹99</div>
                                </div>
                            </div>

                            <div class="product-card" data-type="item" data-category="dates" data-product="Date Syrup" data-price="199">
                                <div class="product-image-wrapper">
                                    <img src="DATES/7.png" alt="Date Syrup" class="product-image">
                                    <div class="product-add-indicator">+</div>
                                </div>
                                <div class="product-info">
                                    <div class="product-name">Date Syrup</div>
                                    <div class="product-price">â‚¹199</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Nuts Section -->
                    <div class="category-section" id="nuts-section">
                        <h3 class="category-section-title">Nuts</h3>
                        <div class="category-items">
                            <!-- Placeholder for future products that will get new mockups -->
                            <div class="product-card" data-type="item" data-category="nuts" data-product="Almond" data-price="299">
                                <div class="product-image-wrapper">
                                    <img src="NUTS/NUTS/OTHER NUT/16.png" alt="Almond" class="product-image">
                                    <div class="product-add-indicator">+</div>
                                </div>
                                <div class="product-info">
                                    <div class="product-name">Almond</div>
                                    <div class="product-price">â‚¹299</div>
                                </div>
                            </div>

                            <div class="product-card" data-type="item" data-category="nuts" data-product="Cashew" data-price="269">
                                <div class="product-image-wrapper">
                                    <img src="NUTS/NUTS/OTHER NUT/15.png" alt="Cashew" class="product-image">
                                    <div class="product-add-indicator">+</div>
                                </div>
                                <div class="product-info">
                                    <div class="product-name">Cashew</div>
                                    <div class="product-price">â‚¹269</div>
                                </div>
                            </div>

                            <div class="product-card" data-type="item" data-category="nuts" data-product="Pistachio" data-price="299">
                                <div class="product-image-wrapper">
                                    <img src="NUTS/NUTS/OTHER NUT/17.png" alt="Pistachio" class="product-image">
                                    <div class="product-add-indicator">+</div>
                                </div>
                                <div class="product-info">
                                    <div class="product-name">Pistachio</div>
                                    <div class="product-price">â‚¹299</div>
                                </div>
                            </div>

                            <div class="product-card" data-type="item" data-category="nuts" data-product="Walnut" data-price="279">
                                <div class="product-image-wrapper">
                                    <img src="NUTS/NUTS/OTHER NUT/18.png" alt="Walnut" class="product-image">
                                    <div class="product-add-indicator">+</div>
                                </div>
                                <div class="product-info">
                                    <div class="product-name">Walnut</div>
                                    <div class="product-price">â‚¹279</div>
                                </div>
                            </div>

                            <!-- Existing products -->
                            <div class="product-card" data-type="item" data-category="nuts" data-product="Hazelnut" data-price="199">
                                <div class="product-image-wrapper">
                                    <img src="NUTS/NUTS/HAZEL NUT/HAZELNUT 100 GM/2(1).png" alt="Hazelnut" class="product-image">
                                    <div class="product-add-indicator">+</div>
                                </div>
                                <div class="product-info">
                                    <div class="product-name">Hazelnut</div>
                                    <div class="product-price">â‚¹199</div>
                                </div>
                            </div>

                            <div class="product-card" data-type="item" data-category="nuts" data-product="Macadamia" data-price="299">
                                <div class="product-image-wrapper">
                                    <img src="NUTS/NUTS/MACADEMIA NUT/MACADAMIA 100 GM/1.png" alt="Macadamia" class="product-image">
                                    <div class="product-add-indicator">+</div>
                                </div>
                                <div class="product-info">
                                    <div class="product-name">Macadamia</div>
                                    <div class="product-price">â‚¹299</div>
                                </div>
                            </div>

                            <div class="product-card" data-type="item" data-category="nuts" data-product="Pecan" data-price="275">
                                <div class="product-image-wrapper">
                                    <img src="NUTS/NUTS/PECAN NUT/PECAN 100 GM/1.png" alt="Pecan" class="product-image">
                                    <div class="product-add-indicator">+</div>
                                </div>
                                <div class="product-info">
                                    <div class="product-name">Pecan</div>
                                    <div class="product-price">â‚¹275</div>
                                </div>
                            </div>

                            <div class="product-card" data-type="item" data-category="nuts" data-product="Pine" data-price="799">
                                <div class="product-image-wrapper">
                                    <img src="NUTS/NUTS/PINE NUT/PINE 100 GM/1.png" alt="Pine" class="product-image">
                                    <div class="product-add-indicator">+</div>
                                </div>
                                <div class="product-info">
                                    <div class="product-name">Pine</div>
                                    <div class="product-price">â‚¹799</div>
                                </div>
                            </div>

                            <div class="product-card" data-type="item" data-category="nuts" data-product="Brazil" data-price="499">
                                <div class="product-image-wrapper">
                                    <img src="NUTS/NUTS/BRAZIL NUT/BRAZIL 100 GM/1.png" alt="Brazil" class="product-image">
                                    <div class="product-add-indicator">+</div>
                                </div>
                                <div class="product-info">
                                    <div class="product-name">Brazil</div>
                                    <div class="product-price">â‚¹499</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Chips Section -->
                    <div class="category-section" id="chips-section">
                        <h3 class="category-section-title">Chips</h3>
                        <div class="category-items chips-layout">
                            <div class="product-card" data-type="item" data-category="chips" data-product="Banana Chips" data-price="49">
                                <div class="product-image-wrapper">
                                    <img src="CHIPS/BANANA.jpg" alt="Banana Chips" class="product-image">
                                    <div class="product-add-indicator">+</div>
                                </div>
                                <div class="product-info">
                                    <div class="product-name">Banana Chips</div>
                                    <div class="product-price">â‚¹49</div>
                                </div>
                            </div>

                            <div class="product-card" data-type="item" data-category="chips" data-product="Spiced Okra Chips" data-price="49">
                                <div class="product-image-wrapper">
                                    <img src="CHIPS/OKRA.png" alt="Spiced Okra Chips" class="product-image">
                                    <div class="product-add-indicator">+</div>
                                </div>
                                <div class="product-info">
                                    <div class="product-name">Spiced Okra Chips</div>
                                    <div class="product-price">â‚¹49</div>
                                </div>
                            </div>

                            <div class="product-card" data-type="item" data-category="chips" data-product="Corn Chips" data-price="49">
                                <div class="product-image-wrapper">
                                    <img src="CHIPS/CORN.jpg" alt="Corn Chips" class="product-image">
                                    <div class="product-add-indicator">+</div>
                                </div>
                                <div class="product-info">
                                    <div class="product-name">Corn Chips</div>
                                    <div class="product-price">â‚¹49</div>
                                </div>
                            </div>

                            <div class="product-card" data-type="item" data-category="chips" data-product="Chickpea Crisps" data-price="49">
                                <div class="product-image-wrapper">
                                    <img src="CHIPS/CHIKPEA.jpg" alt="Chickpea Crisps" class="product-image">
                                    <div class="product-add-indicator">+</div>
                                </div>
                                <div class="product-info">
                                    <div class="product-name">Chickpea Crisps</div>
                                    <div class="product-price">â‚¹49</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Gifting Section -->
                    <div class="category-section" id="gifting-section">
                        <h3 class="category-section-title">Gifting</h3>
                        <div class="category-items gifting-layout">
                            <div class="product-card" data-type="item" data-category="gifting" data-product="Blossom Gift Box" data-price="449">
                                <div class="product-image-wrapper">
                                    <img src="GIFTING/Blossom Gift box/1.png" alt="Blossom Gift Box" class="product-image">
                                    <div class="product-add-indicator">+</div>
                                </div>
                                <div class="product-info">
                                    <div class="product-name">Blossom</div>
                                    <div class="product-price">â‚¹449</div>
                                </div>
                            </div>
                            <div class="product-card" data-type="item" data-category="gifting" data-product="Cadeau Gift Box" data-price="329">
                                <div class="product-image-wrapper">
                                    <img src="GIFTING/Cadeau Gift box/1.png" alt="Cadeau Gift Box" class="product-image">
                                    <div class="product-add-indicator">+</div>
                                </div>
                                <div class="product-info">
                                    <div class="product-name">Cadeau</div>
                                    <div class="product-price">â‚¹329</div>
                                </div>
                            </div>
                            <div class="product-card" data-type="item" data-category="gifting" data-product="Ethic Gift Box" data-price="379">
                                <div class="product-image-wrapper">
                                    <img src="GIFTING/Ethic Gift Box/1.png" alt="Ethic Gift Box" class="product-image">
                                    <div class="product-add-indicator">+</div>
                                </div>
                                <div class="product-info">
                                    <div class="product-name">Ethnic</div>
                                    <div class="product-price">â‚¹379</div>
                                </div>
                            </div>
                            <div class="product-card" data-type="item" data-category="gifting" data-product="Fleur Gift Box" data-price="399">
                                <div class="product-image-wrapper">
                                    <img src="GIFTING/Fleur Gift box/1.png" alt="Fleur Gift Box" class="product-image">
                                    <div class="product-add-indicator">+</div>
                                </div>
                                <div class="product-info">
                                    <div class="product-name">Fleur</div>
                                    <div class="product-price">â‚¹399</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Extra spacing after Gifting section -->
                    <div style="height: 250px;"></div>

                </div>
                    </div>
                </div>
            </div>

            <!-- STEP 2: Basket Selection -->
            <div class="step-content" data-step="1">
                <div class="step-layout">
                    <!-- Left Sidebar with Filters -->
                    <div class="filter-sidebar">
                        <div class="filter-tabs">
                            <button class="filter-tab active" data-filter="cane" onclick="filterBaskets('cane', this)">Cane</button>
                            <button class="filter-tab" data-filter="bamboo" onclick="filterBaskets('bamboo', this)">Bamboo</button>
                            <button class="filter-tab" data-filter="premium" onclick="filterBaskets('premium', this)">Premium</button>
                        </div>
                    </div>
                    
                    <!-- Main Content Area -->
                    <div class="main-content-area">
                        <div class="step-header-row">
                            <h2 class="step-heading" id="step2Heading">Step 2: Choose your basket</h2>
                        </div>

                        <div class="product-grid" id="basketsGrid">
                    <!-- Cane Baskets Section -->
                    <div class="category-section" id="cane-section">
                        <h3 class="category-section-title">Cane Baskets</h3>
                        <div class="category-items">
                            <div class="product-card" data-type="basket" data-category="cane" data-product="Natural Weave Cane" data-price="399">
                                <div class="product-image-wrapper">
                                    <img src="CANE/1.png" alt="Natural Weave Cane" class="product-image">
                                    <div class="product-add-indicator">+</div>
                                </div>
                                <div class="product-info">
                                    <div class="product-name">Natural Weave Cane</div>
                                    <div class="product-price">â‚¹399</div>
                                </div>
                            </div>

                            <div class="product-card" data-type="basket" data-category="cane" data-product="Rustic Cane Classic" data-price="399">
                                <div class="product-image-wrapper">
                                    <img src="CANE/2.png" alt="Rustic Cane Classic" class="product-image">
                                    <div class="product-add-indicator">+</div>
                                </div>
                                <div class="product-info">
                                    <div class="product-name">Rustic Cane Classic</div>
                                    <div class="product-price">â‚¹399</div>
                                </div>
                            </div>

                            <div class="product-card" data-type="basket" data-category="cane" data-product="Traditional Cane Charm" data-price="399">
                                <div class="product-image-wrapper">
                                    <img src="CANE/3.png" alt="Traditional Cane Charm" class="product-image">
                                    <div class="product-add-indicator">+</div>
                                </div>
                                <div class="product-info">
                                    <div class="product-name">Traditional Cane Charm</div>
                                    <div class="product-price">â‚¹399</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Bamboo Baskets Section -->
                    <div class="category-section" id="bamboo-section">
                        <h3 class="category-section-title">Bamboo Baskets</h3>
                        <div class="category-items">
                            <div class="product-card" data-type="basket" data-category="bamboo" data-product="Eco Bamboo Delight" data-price="599">
                                <div class="product-image-wrapper">
                                    <img src="BAMBOO/1.png" alt="Eco Bamboo Delight" class="product-image">
                                    <div class="product-add-indicator">+</div>
                                </div>
                                <div class="product-info">
                                    <div class="product-name">Eco Bamboo Delight</div>
                                    <div class="product-price">â‚¹599</div>
                                </div>
                            </div>

                            <div class="product-card" data-type="basket" data-category="bamboo" data-product="Bamboo Elegance" data-price="599">
                                <div class="product-image-wrapper">
                                    <img src="BAMBOO/2.png" alt="Bamboo Elegance" class="product-image">
                                    <div class="product-add-indicator">+</div>
                                </div>
                                <div class="product-info">
                                    <div class="product-name">Bamboo Elegance</div>
                                    <div class="product-price">â‚¹599</div>
                                </div>
                            </div>

                            <div class="product-card" data-type="basket" data-category="bamboo" data-product="Sustainable Bamboo Choice" data-price="599">
                                <div class="product-image-wrapper">
                                    <img src="BAMBOO/3.png" alt="Sustainable Bamboo Choice" class="product-image">
                                    <div class="product-add-indicator">+</div>
                                </div>
                                <div class="product-info">
                                    <div class="product-name">Sustainable Bamboo Choice</div>
                                    <div class="product-price">â‚¹599</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Premium Baskets Section -->
                    <div class="category-section" id="premium-section">
                        <h3 class="category-section-title">Premium Baskets</h3>
                        <div class="category-items">
                            <div class="product-card" data-type="basket" data-category="premium" data-product="Luxury Wicker Collection" data-price="799">
                                <div class="product-image-wrapper">
                                    <img src="PREMIUM/1.png" alt="Luxury Wicker Collection" class="product-image">
                                    <div class="product-add-indicator">+</div>
                                </div>
                                <div class="product-info">
                                    <div class="product-name">Luxury Wicker Collection</div>
                                    <div class="product-price">â‚¹799</div>
                                </div>
                            </div>

                            <div class="product-card" data-type="basket" data-category="premium" data-product="Artisan Crafted Premium" data-price="799">
                                <div class="product-image-wrapper">
                                    <img src="PREMIUM/2.png" alt="Artisan Crafted Premium" class="product-image">
                                    <div class="product-add-indicator">+</div>
                                </div>
                                <div class="product-info">
                                    <div class="product-name">Artisan Crafted Premium</div>
                                    <div class="product-price">â‚¹799</div>
                                </div>
                            </div>

                            <div class="product-card" data-type="basket" data-category="premium" data-product="Executive Gift Basket" data-price="799">
                                <div class="product-image-wrapper">
                                    <img src="PREMIUM/3.png" alt="Executive Gift Basket" class="product-image">
                                    <div class="product-add-indicator">+</div>
                                </div>
                                <div class="product-info">
                                    <div class="product-name">Executive Gift Basket</div>
                                    <div class="product-price">â‚¹799</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Extra spacing after Premium section -->
                    <div style="height: 250px;"></div>

                </div>
                    </div>
                </div>
            </div>

            <!-- STEP 3: Net Selection -->
            <div class="step-content" data-step="2">
                <div class="step-layout">
                    <!-- Left Sidebar with Filters -->
                    <div class="filter-sidebar">
                        <div class="filter-tabs">
                            <!-- No filters needed for nets, but keeping structure consistent -->
                        </div>
                    </div>
                    
                    <!-- Main Content Area -->
                    <div class="main-content-area">
                        <div class="step-header-row">
                            <h2 class="step-heading" id="step3Heading">Step 3: Choose your net</h2>
                        </div>

                        <div class="product-grid">
                    <div class="product-card" data-type="net" data-product="Turquoise Net" data-price="99">
                        <div class="product-image-wrapper">
                            <img src="NETS/224-TURQUOISE.png" alt="Turquoise Net" class="product-image">
                            <div class="product-add-indicator">+</div>
                        </div>
                        <div class="product-info">
                            <div class="product-name">Turquoise Net</div>
                            <div class="product-price">â‚¹99</div>
                        </div>
                    </div>

                    <div class="product-card" data-type="net" data-product="Yellow Net" data-price="99">
                        <div class="product-image-wrapper">
                            <img src="NETS/295-YELLOW.png" alt="Yellow Net" class="product-image">
                            <div class="product-add-indicator">+</div>
                        </div>
                        <div class="product-info">
                            <div class="product-name">Yellow Net</div>
                            <div class="product-price">â‚¹99</div>
                        </div>
                    </div>

                    <div class="product-card" data-type="net" data-product="Peach Net" data-price="99">
                        <div class="product-image-wrapper">
                            <img src="NETS/327-PEACH.png" alt="Peach Net" class="product-image">
                            <div class="product-add-indicator">+</div>
                        </div>
                        <div class="product-info">
                            <div class="product-name">Peach Net</div>
                            <div class="product-price">â‚¹99</div>
                        </div>
                    </div>

                    <div class="product-card" data-type="net" data-product="Lavender Net" data-price="99">
                        <div class="product-image-wrapper">
                            <img src="NETS/332-LAVENDER.png" alt="Lavender Net" class="product-image">
                            <div class="product-add-indicator">+</div>
                        </div>
                        <div class="product-info">
                            <div class="product-name">Lavender Net</div>
                            <div class="product-price">â‚¹99</div>
                        </div>
                    </div>

                    <div class="product-card" data-type="net" data-product="Sky Blue Net" data-price="99">
                        <div class="product-image-wrapper">
                            <img src="NETS/333-SKY BLUE.png" alt="Sky Blue Net" class="product-image">
                            <div class="product-add-indicator">+</div>
                        </div>
                        <div class="product-info">
                            <div class="product-name">Sky Blue Net</div>
                            <div class="product-price">â‚¹99</div>
                        </div>
                    </div>

                    <div class="product-card" data-type="net" data-product="Pink Net" data-price="99">
                        <div class="product-image-wrapper">
                            <img src="NETS/335-PINK.png" alt="Pink Net" class="product-image">
                            <div class="product-add-indicator">+</div>
                        </div>
                        <div class="product-info">
                            <div class="product-name">Pink Net</div>
                            <div class="product-price">â‚¹99</div>
                        </div>
                    </div>
                </div>
                    </div>
                </div>

                    <!-- Extra spacing after Nets section -->
                    <div style="height: 250px;"></div>

            </div>

            <!-- STEP 4: Ribbon Selection -->
            <div class="step-content" data-step="3">
                <div class="step-layout">
                    <!-- Left Sidebar with Filters -->
                    <div class="filter-sidebar">
                        <div class="filter-tabs">
                            <!-- No filters needed for ribbons, but keeping structure consistent -->
                        </div>
                    </div>
                    
                    <!-- Main Content Area -->
                    <div class="main-content-area">
                        <div class="step-header-row">
                            <h2 class="step-heading" id="step4Heading">Step 4: Choose your ribbon</h2>
                        </div>

                        <div class="product-grid">
                    <div class="product-card" data-type="ribbon" data-product="Gold Ribbon" data-price="99">
                        <div class="product-image-wrapper">
                            <img src="RIBBONS/GOLD.png" alt="Gold Ribbon" class="product-image">
                            <div class="product-add-indicator">+</div>
                        </div>
                        <div class="product-info">
                            <div class="product-name">Gold Ribbon</div>
                            <div class="product-price">â‚¹99</div>
                        </div>
                    </div>

                    <div class="product-card" data-type="ribbon" data-product="Ivory Ribbon" data-price="99">
                        <div class="product-image-wrapper">
                            <img src="RIBBONS/IVORY.png" alt="Ivory Ribbon" class="product-image">
                            <div class="product-add-indicator">+</div>
                        </div>
                        <div class="product-info">
                            <div class="product-name">Ivory Ribbon</div>
                            <div class="product-price">â‚¹99</div>
                        </div>
                    </div>

                    <div class="product-card" data-type="ribbon" data-product="Lemon Yellow Ribbon" data-price="99">
                        <div class="product-image-wrapper">
                            <img src="RIBBONS/LEMON YELLOW.png" alt="Lemon Yellow Ribbon" class="product-image">
                            <div class="product-add-indicator">+</div>
                        </div>
                        <div class="product-info">
                            <div class="product-name">Lemon Yellow Ribbon</div>
                            <div class="product-price">â‚¹99</div>
                        </div>
                    </div>

                    <div class="product-card" data-type="ribbon" data-product="Light Purple Ribbon" data-price="99">
                        <div class="product-image-wrapper">
                            <img src="RIBBONS/LIGHT PURPLE.png" alt="Light Purple Ribbon" class="product-image">
                            <div class="product-add-indicator">+</div>
                        </div>
                        <div class="product-info">
                            <div class="product-name">Light Purple Ribbon</div>
                            <div class="product-price">â‚¹99</div>
                        </div>
                    </div>

                    <div class="product-card" data-type="ribbon" data-product="Maroon Ribbon" data-price="99">
                        <div class="product-image-wrapper">
                            <img src="RIBBONS/MAROON.png" alt="Maroon Ribbon" class="product-image">
                            <div class="product-add-indicator">+</div>
                        </div>
                        <div class="product-info">
                            <div class="product-name">Maroon Ribbon</div>
                            <div class="product-price">â‚¹99</div>
                        </div>
                    </div>

                    <div class="product-card" data-type="ribbon" data-product="Peach Ribbon" data-price="99">
                        <div class="product-image-wrapper">
                            <img src="RIBBONS/PEACH.png" alt="Peach Ribbon" class="product-image">
                            <div class="product-add-indicator">+</div>
                        </div>
                        <div class="product-info">
                            <div class="product-name">Peach Ribbon</div>
                            <div class="product-price">â‚¹99</div>
                        </div>
                    </div>

                    <div class="product-card" data-type="ribbon" data-product="Pink Ribbon" data-price="99">
                        <div class="product-image-wrapper">
                            <img src="RIBBONS/PINK.png" alt="Pink Ribbon" class="product-image">
                            <div class="product-add-indicator">+</div>
                        </div>
                        <div class="product-info">
                            <div class="product-name">Pink Ribbon</div>
                            <div class="product-price">â‚¹99</div>
                        </div>
                    </div>

                    <div class="product-card" data-type="ribbon" data-product="Sky Blue Ribbon" data-price="99">
                        <div class="product-image-wrapper">
                            <img src="RIBBONS/SKY BLUE.png" alt="Sky Blue Ribbon" class="product-image">
                            <div class="product-add-indicator">+</div>
                        </div>
                        <div class="product-info">
                            <div class="product-name">Sky Blue Ribbon</div>
                            <div class="product-price">â‚¹99</div>
                        </div>
                    </div>

                    <div class="product-card" data-type="ribbon" data-product="Tangerine Ribbon" data-price="99">
                        <div class="product-image-wrapper">
                            <img src="RIBBONS/TANGERINE.png" alt="Tangerine Ribbon" class="product-image">
                            <div class="product-add-indicator">+</div>
                        </div>
                        <div class="product-info">
                            <div class="product-name">Tangerine Ribbon</div>
                            <div class="product-price">â‚¹99</div>
                        </div>
                    </div>
                </div>

                    </div>
                </div>

                    <!-- Extra spacing after Ribbons section -->
                    <div style="height: 250px;"></div>

            </div>

            <!-- STEP 5: Checkout Summary -->
            <div class="step-content" data-step="4">
                <div class="step-layout">
                    <!-- Left Sidebar with Filters -->
                    <div class="filter-sidebar">
                        <div class="filter-tabs">
                            <!-- No filters needed for summary, but keeping structure consistent -->
                        </div>
                    </div>
                    
                    <!-- Main Content Area -->
                    <div class="main-content-area">
                        <div class="step-header-row">
                            <h2 class="step-heading" id="step5Heading">Step 5: Review your order</h2>
                        </div>
                <div id="basketSummary">
                </div>

                <div id="itemsSummary" style="display: none;">
                </div>

                <div id="netSummary" style="display: none;">
                </div>

                <div id="ribbonSummary" style="display: none;">
                </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- RIGHT COLUMN: Cart -->
        <aside class="cart-summary" id="cartSummary">
            <img src="logo.png" alt="Flyberry Logo" class="cart-logo">
            <div class="cart-header">
                <h3 class="cart-title" id="cartTitle">{username's} gift basket</h3>
                <button class="cart-toggle-btn" id="cartToggleBtn" title="Expand/Collapse Cart">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M7 14L12 9L17 14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
            </div>
            
            <div class="cart-content">
                <!-- Empty Cart Message -->
                <div class="empty-cart-message" id="emptyCartMessage">
                    <p>ðŸ§º Your basket is feeling lonely!</p>
                    <p>It's dreaming of delicious dates and nuts...</p>
                    <p>Why not make its dreams come true? ðŸ˜‹</p>
                </div>
                
                <div class="cart-section" id="cartBaskets" style="display: none;">
                    <div class="cart-section-title">Baskets</div>
                    <div id="cartBasketsContent"></div>
                </div>

                <div class="cart-section" id="cartItems" style="display: none;">
                    <div class="cart-section-title">Items</div>
                    <div id="cartItemsContent"></div>
                </div>

                <div class="cart-section" id="cartNets" style="display: none;">
                    <div class="cart-section-title">Nets</div>
                    <div id="cartNetsContent"></div>
                </div>

                <div class="cart-section" id="cartRibbons" style="display: none;">
                    <div class="cart-section-title">Ribbons</div>
                    <div id="cartRibbonsContent"></div>
                </div>

                <div class="cart-total">
                    <div class="cart-subtotal">
                        <div class="cart-subtotal-label">Subtotal</div>
                        <div class="cart-subtotal-price" id="cartSubtotal">â‚¹0</div>
                    </div>
                    <div class="cart-discount" id="cartDiscountRow" style="display: none;">
                        <div class="cart-discount-label" id="cartDiscountLabel">Discount (15%)</div>
                        <div class="cart-discount-price" id="cartDiscountAmount">-â‚¹0</div>
                    </div>
                    <div class="cart-final-total">
                        <div class="cart-total-label">Total</div>
                        <div class="cart-total-price" id="cartTotal">â‚¹0</div>
                    </div>
                </div>
            </div>
            
            <!-- Navigation Buttons Sticky at Bottom -->
            <div class="cart-nav-buttons">
                <button class="nav-btn btn-next" id="cartNextBtn" onclick="nextStep()">Next</button>
                <button class="nav-btn btn-back" id="cartBackBtn" onclick="prevStep()" style="display: none;">Back</button>
            </div>
        </aside>
    </div>

    <!-- Extra spacing after Summary section -->
    <div style="height: 250px;"></div>

    <!-- Global Step Navigation -->
    <div class="step-navigation main-navigation">
        <div class="progress-steps">
            <button class="progress-step active" data-step="0" onclick="goToStep(0)">1. Items</button>
            <button class="progress-step" data-step="1" onclick="goToStep(1)">2. Basket</button>
            <button class="progress-step" data-step="2" onclick="goToStep(2)">3. Net</button>
            <button class="progress-step" data-step="3" onclick="goToStep(3)">4. Ribbon</button>
            <button class="progress-step" data-step="4" onclick="goToStep(4)">Summary</button>
        </div>
    </div>

    <script>
        // State
        let currentStep = 0;
        let selections = {
            baskets: [], // Multiple baskets support
            items: [],
            nets: [], // Changed to array to support multiple nets
            ribbons: [] // Changed to array to support multiple ribbons
        };

        // Quantity management (keeping for compatibility with nets/ribbons)
        let quantities = {
            net: 1,
            ribbon: 1
        };

        // Current tooltip product data
        let currentTooltipProduct = null;
        let selectedVariant = null;
        let currentImageIndex = 0;
        let currentImages = [];

        // Toast notification functions
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toastNotification');
            toast.textContent = message;
            toast.className = `toast-notification ${type}`;
            
            // Show the toast
            setTimeout(() => toast.classList.add('show'), 100);
            
            // Hide the toast after 3 seconds
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Product data with descriptions and variants
        const productData = {
            // Dates (200g Square Box only)
            "Date Bite": {
                description: "Bite-sized date treats perfect for snacking. Naturally sweet and energy-packed.\n\nSize: 160g",
                images: [
                    "DATES/DATE BITE/1.png",
                    "DATES/DATE BITE/2.png",
                    "DATES/DATE BITE/3.png",
                    "DATES/DATE BITE/4.png"
                ],
                variants: [
                    { name: "160g", price: 399 }
                ]
            },
            "Mini Medjoul": {
                description: "The king of dates - Mini Medjoul. Rich, soft, and incredibly sweet with luxurious texture.\n\nSize: 250g",
                images: [
                    "DATES/MINI MEDJOUL/1.png",
                    "DATES/MINI MEDJOUL/2.png",
                    "DATES/MINI MEDJOUL/3.png",
                    "DATES/MINI MEDJOUL/4.png",
                    "DATES/MINI MEDJOUL/5.png"
                ],
                variants: [
                    { name: "250g", price: 499 }
                ]
            },
            "Deri Dates": {
                description: "Traditional Deri dates with authentic taste and natural sweetness.\n\nSize: 250g",
                images: [
                    "DATES/DERI/DERI 250 g/1.png",
                    "DATES/DERI/DERI 250 g/2.png",
                    "DATES/DERI/DERI 250 g/3.png",
                    "DATES/DERI/DERI 250 g/4.png",
                    "DATES/DERI/DERI 250 g/5.png"
                ],
                variants: [
                    { name: "250g", price: 249 }
                ]
            },
            "Deglet Dates": {
                description: "Delicate and translucent Deglet Noor dates with firm texture and honey-like sweetness.\n\nSize: 200g",
                images: [
                    "DATES/DEGLET/1.png",
                    "DATES/DEGLET/2.png",
                    "DATES/DEGLET/3.png",
                    "DATES/DEGLET/4.png",
                    "DATES/DEGLET/5.png"
                ],
                variants: [
                    { name: "200g", price: 399 }
                ]
            },
            "Kalmi Dates": {
                description: "Soft and juicy Kalmi dates with exceptional sweetness and smooth texture.\n\nSize: 200g",
                images: [
                    "DATES/KALMI/1.png",
                    "DATES/KALMI/2.png",
                    "DATES/KALMI/3.png",
                    "DATES/KALMI/4.png",
                    "DATES/KALMI/5.png"
                ],
                variants: [
                    { name: "200g", price: 399 }
                ]
            },
            "Ameri Dates": {
                description: "Premium quality Ameri dates with rich, sweet flavor and soft texture.\n\nSize: 200g",
                images: [
                    "DATES/AMERI/1.png",
                    "DATES/AMERI/2.png",
                    "DATES/AMERI/3.png",
                    "DATES/AMERI/4.png",
                    "DATES/AMERI/5.png"
                ],
                variants: [
                    { name: "200g", price: 299 }
                ]
            },
            "Hazelnut Chocolate Spread": {
                description: "Rich hazelnut chocolate spread perfect for bread and desserts. Indulgent and creamy texture.\n\nSize: 100g",
                images: ["DATES/6.png"],
                variants: [
                    { name: "100g", price: 299 }
                ]
            },
            "Date Powder": {
                description: "Nutrient-rich date powder, perfect for smoothies and health drinks. Natural sweetener alternative.\n\nSize: 50g",
                images: ["DATES/8.png"],
                variants: [
                    { name: "50g", price: 99 }
                ]
            },
            "Date Syrup": {
                description: "Natural date syrup, a healthy alternative to sugar and artificial sweeteners.\n\nSize: 100g",
                images: ["DATES/7.png"],
                variants: [
                    { name: "100g", price: 199 }
                ]
            },
            // Nuts (100g Pack only)
            "Almond": {
                description: "Premium California almonds rich in vitamin E and healthy fats. Perfect for daily nutrition and snacking.\n\nSize: 100g",
                images: ["NUTS/NUTS/OTHER NUT/16.png"],
                variants: [
                    { name: "100g", price: 299 }
                ]
            },
            "Cashew": {
                description: "Creamy cashew nuts with rich, buttery flavor. A versatile nut perfect for cooking and snacking.\n\nSize: 100g",
                images: ["NUTS/NUTS/OTHER NUT/15.png"],
                variants: [
                    { name: "100g", price: 269 }
                ]
            },
            "Pistachio": {
                description: "Premium Iranian pistachios with distinctive flavor and natural goodness. A gourmet delight.\n\nSize: 100g",
                images: ["NUTS/NUTS/OTHER NUT/17.png"],
                variants: [
                    { name: "100g", price: 299 }
                ]
            },
            "Walnut": {
                description: "Brain-shaped walnuts rich in omega-3 fatty acids. Known for their health benefits and distinctive taste.\n\nSize: 75g",
                images: ["NUTS/NUTS/OTHER NUT/18.png"],
                variants: [
                    { name: "75g", price: 279 }
                ]
            },
            "Hazelnut": {
                description: "Premium hazelnuts with delicate, sweet flavor and crunchy texture. Perfect for snacking or baking.\n\nSize: 100g",
                images: [
                    "NUTS/NUTS/HAZEL NUT/HAZELNUT 100 GM/2.png",
                    "NUTS/NUTS/HAZEL NUT/HAZELNUT 100 GM/2(1).png",
                    "NUTS/NUTS/HAZEL NUT/HAZELNUT 100 GM/3.png",
                    "NUTS/NUTS/HAZEL NUT/HAZELNUT 100 GM/4.png",
                    "NUTS/NUTS/HAZEL NUT/HAZELNUT 100 GM/4(1).png",
                    "NUTS/NUTS/HAZEL NUT/HAZELNUT 100 GM/6.png"
                ],
                variants: [
                    { name: "100g", price: 399 }
                ]
            },
            "Macadamia": {
                description: "Luxurious macadamia nuts with buttery texture and rich flavor. Known as the 'king of nuts'.\n\nSize: 100g",
                images: [
                    "NUTS/NUTS/MACADEMIA NUT/MACADAMIA 100 GM/1.png",
                    "NUTS/NUTS/MACADEMIA NUT/MACADAMIA 100 GM/2.png",
                    "NUTS/NUTS/MACADEMIA NUT/MACADAMIA 100 GM/3.png",
                    "NUTS/NUTS/MACADEMIA NUT/MACADAMIA 100 GM/4.png",
                    "NUTS/NUTS/MACADEMIA NUT/MACADAMIA 100 GM/5.png",
                    "NUTS/NUTS/MACADEMIA NUT/MACADAMIA 100 GM/6.png"
                ],
                variants: [
                    { name: "100g", price: 499 }
                ]
            },
            "Pecan": {
                description: "Sweet and buttery pecan nuts with rich, distinctive flavor. Perfect for snacking and desserts.\n\nSize: 100g",
                images: [
                    "NUTS/NUTS/PECAN NUT/PECAN 100 GM/1.png",
                    "NUTS/NUTS/PECAN NUT/PECAN 100 GM/2.png",
                    "NUTS/NUTS/PECAN NUT/PECAN 100 GM/3.png",
                    "NUTS/NUTS/PECAN NUT/PECAN 100 GM/4.png",
                    "NUTS/NUTS/PECAN NUT/PECAN 100 GM/5.png",
                    "NUTS/NUTS/PECAN NUT/PECAN 100 GM/6.png"
                ],
                variants: [
                    { name: "100g", price: 449 }
                ]
            },
            "Pine": {
                description: "Delicate pine nuts with subtle, sweet flavor. A gourmet ingredient perfect for Mediterranean cuisine.\n\nSize: 100g",
                images: [
                    "NUTS/NUTS/PINE NUT/PINE 100 GM/1.png",
                    "NUTS/NUTS/PINE NUT/PINE 100 GM/2.png",
                    "NUTS/NUTS/PINE NUT/PINE 100 GM/3.png",
                    "NUTS/NUTS/PINE NUT/PINE 100 GM/4.png",
                    "NUTS/NUTS/PINE NUT/PINE 100 GM/5.png",
                    "NUTS/NUTS/PINE NUT/PINE 100 GM/6.png"
                ],
                variants: [
                    { name: "100g", price: 529 }
                ]
            },
            "Brazil": {
                description: "Premium Brazil nuts packed with selenium and healthy fats. Crunchy texture with rich, buttery flavor.\n\nSize: 100g",
                images: [
                    "NUTS/NUTS/BRAZIL NUT/BRAZIL 100 GM/1.png",
                    "NUTS/NUTS/BRAZIL NUT/BRAZIL 100 GM/2.png",
                    "NUTS/NUTS/BRAZIL NUT/BRAZIL 100 GM/3.png",
                    "NUTS/NUTS/BRAZIL NUT/BRAZIL 100 GM/4.png",
                    "NUTS/NUTS/BRAZIL NUT/BRAZIL 100 GM/5.png",
                    "NUTS/NUTS/BRAZIL NUT/BRAZIL 100 GM/6.png"
                ],
                variants: [
                    { name: "100g", price: 349 }
                ]
            },
            // Chips
            "Banana Chips": {
                description: "Crispy banana chips made from premium bananas. A healthy and delicious snacking option.\n\nSize: 50g",
                images: ["CHIPS/BANANA.jpg"],
                variants: [
                    { name: "50g", price: 149 }
                ]
            },
            "Spiced Okra Chips": {
                description: "Unique and crispy spiced okra chips with distinctive taste. A healthy vegetable-based snack.\n\nSize: 20g",
                images: ["CHIPS/OKRA.png"],
                variants: [
                    { name: "20g", price: 49 }
                ]
            },
            "Corn Chips": {
                description: "Golden corn chips with authentic corn flavor. Perfect for parties and casual snacking.\n\nSize: 50g",
                images: ["CHIPS/CORN.jpg"],
                variants: [
                    { name: "50g", price: 139 }
                ]
            },
            "Chickpea Crisps": {
                description: "Protein-rich chickpea crisps with satisfying crunch. A nutritious alternative to regular chips.\n\nSize: 25g",
                images: ["CHIPS/CHIKPEA.jpg"],
                variants: [
                    { name: "25g", price: 49 }
                ]
            },
            // Gifting
            "Blossom Gift Box": {
                description: "Elegant Blossom gift box perfect for special occasions. This is a mixture of carefully assorted: Trail Mix, Cashew Peri Peri, Green Raisins, Date Bites.\n\nSize: 200g",
                images: [
                    "GIFTING/Blossom Gift box/1.png",
                    "GIFTING/Blossom Gift box/3.png",
                    "GIFTING/Blossom Gift box/4.png",
                    "GIFTING/Blossom Gift box/5.png"
                ],
                variants: [
                    { name: "200g", price: 449 }
                ]
            },
            "Cadeau Gift Box": {
                description: "Sophisticated Cadeau gift box designed for discerning recipients. This is a mixture of carefully assorted: Trail Mix, Cashew Peri Peri, Green Raisins, Date Bites.\n\nSize: 200g",
                images: [
                    "GIFTING/Cadeau Gift box/1.png",
                    "GIFTING/Cadeau Gift box/3.png",
                    "GIFTING/Cadeau Gift box/4.png",
                    "GIFTING/Cadeau Gift box/5.png"
                ],
                variants: [
                    { name: "200g", price: 329 }
                ]
            },
            "Ethic Gift Box": {
                description: "Thoughtfully curated Ethic gift box with sustainable and ethical products. This is a mixture of carefully assorted: Trail Mix, Cashew Peri Peri, Green Raisins, Date Bites.\n\nSize: 200g",
                images: [
                    "GIFTING/Ethic Gift Box/1.png",
                    "GIFTING/Ethic Gift Box/3.png",
                    "GIFTING/Ethic Gift Box/4.png",
                    "GIFTING/Ethic Gift Box/5.png"
                ],
                variants: [
                    { name: "200g", price: 379 }
                ]
            },
            "Fleur Gift Box": {
                description: "Beautiful Fleur gift box with floral-themed presentation. This is a mixture of carefully assorted: Trail Mix, Cashew Peri Peri, Green Raisins, Date Bites.\n\nSize: 200g",
                images: [
                    "GIFTING/Fleur Gift box/1.png",
                    "GIFTING/Fleur Gift box/3.png",
                    "GIFTING/Fleur Gift box/4.png",
                    "GIFTING/Fleur Gift box/5.png"
                ],
                variants: [
                    { name: "200g", price: 399 }
                ]
            }
        };

        // Image Carousel Functions
        function initializeImageCarousel(images) {
            currentImages = images;
            currentImageIndex = 0;
            
            const carouselContainer = document.getElementById('carouselContainer');
            const carouselDots = document.getElementById('carouselDots');
            
            // Clear existing images and dots
            carouselContainer.innerHTML = '';
            carouselDots.innerHTML = '';
            
            // Create image elements
            images.forEach((imageSrc, index) => {
                const img = document.createElement('img');
                img.className = `tooltip-image ${index === 0 ? 'active' : ''}`;
                img.src = imageSrc;
                img.alt = `Product image ${index + 1}`;
                carouselContainer.appendChild(img);
            });
            
            // Add navigation elements if more than 1 image
            if (images.length > 1) {
                // Add navigation arrows
                const prevArrow = document.createElement('button');
                prevArrow.className = 'carousel-arrow carousel-prev';
                prevArrow.innerHTML = 'â€¹';
                prevArrow.onclick = prevImage;
                prevArrow.setAttribute('aria-label', 'Previous image');
                carouselContainer.appendChild(prevArrow);
                
                const nextArrow = document.createElement('button');
                nextArrow.className = 'carousel-arrow carousel-next';
                nextArrow.innerHTML = 'â€º';
                nextArrow.onclick = nextImage;
                nextArrow.setAttribute('aria-label', 'Next image');
                carouselContainer.appendChild(nextArrow);
                
                // Add navigation dots
                carouselDots.classList.remove('hidden');
                images.forEach((_, index) => {
                    const dot = document.createElement('button');
                    dot.className = `carousel-dot ${index === 0 ? 'active' : ''}`;
                    dot.onclick = () => goToImage(index);
                    dot.setAttribute('aria-label', `Go to image ${index + 1}`);
                    carouselDots.appendChild(dot);
                });
            } else {
                carouselDots.classList.add('hidden');
            }
        }

        function goToImage(index) {
            if (index < 0 || index >= currentImages.length) return;
            
            currentImageIndex = index;
            
            // Update active image
            const images = document.querySelectorAll('.tooltip-image');
            images.forEach((img, i) => {
                img.classList.toggle('active', i === index);
            });
            
            // Update active dot
            const dots = document.querySelectorAll('.carousel-dot');
            dots.forEach((dot, i) => {
                dot.classList.toggle('active', i === index);
            });
        }

        function nextImage() {
            const nextIndex = (currentImageIndex + 1) % currentImages.length;
            goToImage(nextIndex);
        }

        function prevImage() {
            const prevIndex = (currentImageIndex - 1 + currentImages.length) % currentImages.length;
            goToImage(prevIndex);
        }



        // Tooltip Functions
        function showTooltip(productCard) {
            const productName = productCard.dataset.product;
            const productPrice = productCard.dataset.price;
            
            // Handle both image elements and div placeholders
            const imageElement = productCard.querySelector('.product-image');
            const productImage = imageElement ? imageElement.src : '';
            
            const productType = productCard.dataset.type;
            
            // Skip tooltip for baskets, nets, and ribbons (single selection items)
            if (productType === 'basket' || productType === 'net' || productType === 'ribbon') {
                return false; // Let the normal click handler proceed
            }

            // Extract base product name (remove variant info if present)
            const baseProductName = productName.includes('(') ? productName.split('(')[0].trim() : productName;
            const data = productData[baseProductName];
            if (!data) {
                return false; // Let the normal click handler proceed
            }

            currentTooltipProduct = {
                name: baseProductName,
                price: productPrice,
                image: productImage,
                type: productType,
                card: productCard,
                data: data
            };

            // Set tooltip content
            document.getElementById('tooltipTitle').textContent = baseProductName;
            document.getElementById('tooltipDescription').innerHTML = data.description.replace(/\n/g, '<br>');
            
            // Initialize image carousel
            initializeImageCarousel(data.images || [data.image || productImage]);

            // Handle variants
            const variantsSection = document.getElementById('tooltipVariants');
            const variantOptions = document.getElementById('variantOptions');
            
            if (data.variants && data.variants.length > 1) {
                variantsSection.style.display = 'block';
                variantOptions.innerHTML = '';
                
                data.variants.forEach((variant, index) => {
                    const option = document.createElement('div');
                    option.className = 'variant-option';
                    option.textContent = `${variant.name} - â‚¹${variant.price}`;
                    option.onclick = () => selectVariant(index);
                    variantOptions.appendChild(option);
                });
                
                // Select first variant by default
                selectVariant(0);
            } else {
                variantsSection.style.display = 'none';
                selectedVariant = data.variants[0];
                document.getElementById('tooltipPrice').textContent = `â‚¹${selectedVariant.price}`;
            }

            // Position tooltip
            positionTooltip(productCard);

            // Show tooltip with animation
            document.getElementById('tooltipOverlay').classList.add('visible');
            setTimeout(() => {
                document.getElementById('productTooltip').classList.add('visible');
            }, 50);

            return true; // Prevent normal click handler
        }

        function hideTooltip() {

            document.getElementById('productTooltip').classList.remove('visible');
            setTimeout(() => {
                document.getElementById('tooltipOverlay').classList.remove('visible');
            }, 300);
            currentTooltipProduct = null;
            selectedVariant = null;
        }

        function selectVariant(index) {
            if (!currentTooltipProduct) return;
            
            const variants = currentTooltipProduct.data.variants;
            selectedVariant = variants[index];
            
            // Update UI - only update price, keep same image
            document.querySelectorAll('.variant-option').forEach((option, i) => {
                option.classList.toggle('selected', i === index);
            });
            
            document.getElementById('tooltipPrice').textContent = `â‚¹${selectedVariant.price}`;
            // Image stays the same for all variants
        }

        function positionTooltip(productCard) {
            const tooltip = document.getElementById('productTooltip');
            
            // Center the tooltip in viewport
            tooltip.style.left = '50%';
            tooltip.style.top = '50%';
            tooltip.style.transform = 'translate(-50%, -50%) scale(0.8)';
            
            // When visible, it will animate to full scale
            setTimeout(() => {
                if (tooltip.classList.contains('visible')) {
                    tooltip.style.transform = 'translate(-50%, -50%) scale(1)';
                }
            }, 50);
        }

        function addFromTooltip() {
            if (!currentTooltipProduct || !selectedVariant) return;
            
            const uniqueProductName = `${currentTooltipProduct.name} (${selectedVariant.name})`;
            const price = selectedVariant.price;
            // Always use the first image from the product data, not the current carousel image
            const image = currentTooltipProduct.data.images && currentTooltipProduct.data.images.length > 0 ? 
                         currentTooltipProduct.data.images[0] : 
                         (currentTooltipProduct.data.image || currentTooltipProduct.image);
            const category = currentTooltipProduct.card.dataset.category;
            
            // Check if item already exists
            const existingItemIndex = selections.items.findIndex(item => item.name === uniqueProductName);
            
            if (existingItemIndex !== -1) {
                // Increase quantity if item exists
                selections.items[existingItemIndex].quantity += 1;
                showToast(`Added another ${currentTooltipProduct.name} to basket!`);
            } else {
                // Add new item to selections
                const itemId = Date.now() + Math.random(); // Generate unique ID
                selections.items.push({ id: itemId, name: uniqueProductName, price, image, category, quantity: 1 });
                showToast(`${currentTooltipProduct.name} added to basket!`);
            }
            
            // Update cart display
            updateCart();
            
            // Hide tooltip
            hideTooltip();
        }

        // Initialize
        updateProgress();
        setupEventListeners();
        
        // Initialize scroll detection
        initializeScrollDetection();
        
        // Initialize go-to-top button visibility
        toggleGoToTopButton();

        function setupEventListeners() {
            // Product card clicks
            document.querySelectorAll('.product-card').forEach(card => {
                card.addEventListener('click', function() {
                    handleProductClick(this);
                });
            });

            // Filter tabs - now work as navigation
            document.querySelectorAll('.filter-tab').forEach(tab => {
                tab.addEventListener('click', function(e) {
                    e.preventDefault();
                    const filter = this.dataset.filter;
                    navigateToCategory(filter);
                });
            });

            // Cart toggle functionality
            const cartToggleBtn = document.getElementById('cartToggleBtn');
            if (cartToggleBtn) {
                cartToggleBtn.addEventListener('click', toggleCart);
            }
        }

        function toggleCart() {
            const cartSummary = document.getElementById('cartSummary');
            const body = document.body;
            
            if (cartSummary.classList.contains('expanded')) {
                // Collapse the cart
                cartSummary.classList.remove('expanded');
                body.classList.remove('cart-expanded');
            } else {
                // Expand the cart
                cartSummary.classList.add('expanded');
                body.classList.add('cart-expanded');
            }
        }

        function handleProductClick(card) {
            const type = card.dataset.type;
            const product = card.dataset.product;
            const price = parseFloat(card.dataset.price);
            
            // Handle both image elements and div placeholders
            const imageElement = card.querySelector('.product-image');
            let image = imageElement ? imageElement.src : '';
            
            // For nets and ribbons, generate white placeholder with black text
            if (type === 'net' || type === 'ribbon') {
                const productName = product.length > 15 ? product.substring(0, 15) + '...' : product;
                image = `data:image/svg+xml;base64,${btoa(`
                    <svg xmlns="http://www.w3.org/2000/svg" width="300" height="300" viewBox="0 0 300 300">
                        <rect width="300" height="300" fill="white" stroke="#e5e7eb" stroke-width="1"/>
                        <text x="150" y="140" text-anchor="middle" font-family="Baloo 2, sans-serif" font-size="24" font-weight="600" fill="black">${productName}</text>
                        <text x="150" y="170" text-anchor="middle" font-family="Baloo 2, sans-serif" font-size="18" font-weight="400" fill="#6b7280">${type === 'net' ? 'Net' : 'Ribbon'}</text>
                    </svg>
                `)}`;
            }
            
            const category = card.dataset.category;

            if (type === 'basket') {
                // Multiple selection for baskets
                const basketId = Date.now() + Math.random(); // Generate unique ID
                const existingBasket = selections.baskets.find(basket => basket.name === product);
                
                if (existingBasket) {
                    // If basket already exists, increase quantity
                    existingBasket.quantity += 1;
                    showToast(`Added another ${product} basket!`);
                } else {
                    // Add new basket
                    selections.baskets.push({ 
                        id: basketId, 
                        name: product, 
                        price, 
                        image, 
                        quantity: 1 
                    });
                    showToast(`${product} basket added!`);
                }
                
                // Update basket counter if exists
                updateBasketCounter(card, existingBasket ? existingBasket.quantity : 1);
                
            } else if (type === 'net') {
                // Multiple selection for nets
                const netId = Date.now() + Math.random();
                const existingNet = selections.nets.find(net => net.name === product);
                
                if (existingNet) {
                    existingNet.quantity += 1;
                    showToast(`Added another ${product} net!`);
                } else {
                    selections.nets.push({ 
                        id: netId, 
                        name: product, 
                        price, 
                        image, 
                        quantity: 1 
                    });
                    showToast(`${product} net selected!`);
                }
                
                updateItemCounter(card, existingNet ? existingNet.quantity : 1);
                
            } else if (type === 'ribbon') {
                // Multiple selection for ribbons
                const ribbonId = Date.now() + Math.random();
                const existingRibbon = selections.ribbons.find(ribbon => ribbon.name === product);
                
                if (existingRibbon) {
                    existingRibbon.quantity += 1;
                    showToast(`Added another ${product} ribbon!`);
                } else {
                    selections.ribbons.push({ 
                        id: ribbonId, 
                        name: product, 
                        price, 
                        image, 
                        quantity: 1 
                    });
                    showToast(`${product} ribbon selected!`);
                }
                
                updateItemCounter(card, existingRibbon ? existingRibbon.quantity : 1);
            } else if (type === 'item') {
                // Check if tooltip should be shown for items with variants
                if (showTooltip(card)) {
                    return; // Tooltip is shown, exit function
                }
                // Multi-selection for items - Check if item exists and increase quantity
                const existingIndex = selections.items.findIndex(item => item.name === product);
                
                if (existingIndex !== -1) {
                    // Increase quantity if item exists
                    selections.items[existingIndex].quantity += 1;
                    showToast(`Added another ${product} to basket!`);
                } else {
                    // Add new item to cart
                    const itemId = Date.now() + Math.random(); // Generate unique ID
                    selections.items.push({ id: itemId, name: product, price, image, category, quantity: 1 });
                    showToast(`${product} added to basket!`);
                }
            }

            updateCart();
        }



        // Navigation function (filters are now navigation only)
        function navigateToCategory(category) {
            const targetSection = document.getElementById(category + '-section');
            if (targetSection) {
                const headerOffset = 140; // Account for sticky headers (step header + category header)
                const elementPosition = targetSection.offsetTop;
                const offsetPosition = elementPosition - headerOffset;
                
                window.scrollTo({
                    top: offsetPosition,
                    behavior: 'smooth'
                });
            }
            
            // Update active tab
            document.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active'));
            document.querySelector(`[data-filter="${category}"]`).classList.add('active');
        }

        function filterBaskets(category, tabElement) {
            // Navigate to specific basket category section
            const targetSection = document.getElementById(category + '-section');
            if (targetSection) {
                const headerOffset = 140; // Account for sticky headers (step header + category header)
                const elementPosition = targetSection.offsetTop;
                const offsetPosition = elementPosition - headerOffset;
                
                window.scrollTo({
                    top: offsetPosition,
                    behavior: 'smooth'
                });
            }
            
            // Update active tab
            const tabs = tabElement.parentElement.querySelectorAll('.filter-tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            tabElement.classList.add('active');
        }

        function changeQuantity(type, delta) {
            if (quantities[type]) {
                const newQty = Math.max(1, quantities[type] + delta);
                quantities[type] = newQty;
                updateCart();
            }
        }

        function changeItemQuantity(itemId, delta) {
            const item = selections.items.find(item => item.id == itemId);
            if (item) {
                const newQty = item.quantity + delta;
                if (newQty <= 0) {
                    // Remove item if quantity would be 0
                    const itemIndex = selections.items.findIndex(i => i.id == itemId);
                    if (itemIndex !== -1) {
                        const removedItem = selections.items[itemIndex];
                        selections.items.splice(itemIndex, 1);
                        showItemRemovedMessage(removedItem.name, 'item');
                    }
                } else {
                    item.quantity = newQty;
                }
                updateCart();
            }
        }

        function changeBasketQuantity(basketId, delta) {
            const basket = selections.baskets.find(basket => basket.id == basketId);
            if (basket) {
                const newQty = basket.quantity + delta;
                if (newQty <= 0) {
                    // Remove basket if quantity would be 0
                    removeBasket(basketId);
                } else {
                    basket.quantity = newQty;
                    updateCart();
                }
            }
        }

        function showBasketAddedMessage(productName) {
            // Create and show a temporary success message
            const message = document.createElement('div');
            message.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #DAA520;
                color: white;
                padding: 12px 20px;
                border-radius: 8px;
                font-weight: 600;
                z-index: 10000;
                animation: slideInRight 0.3s ease-out;
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            `;
            message.textContent = `âœ“ ${productName} added to cart!`;
            
            // Add animation styles
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideInRight {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
            `;
            document.head.appendChild(style);
            
            document.body.appendChild(message);
            
            // Remove after 2 seconds
            setTimeout(() => {
                message.style.animation = 'slideInRight 0.3s ease-out reverse';
                setTimeout(() => {
                    if (message.parentNode) {
                        message.parentNode.removeChild(message);
                    }
                }, 300);
            }, 2000);
        }

        function updateBasketCounter(card, quantity) {
            // Remove existing counter
            const existingCounter = card.querySelector('.basket-counter');
            if (existingCounter) {
                existingCounter.remove();
            }
            
            // Add new counter if quantity > 1
            if (quantity > 1) {
                const counter = document.createElement('div');
                counter.className = 'basket-counter';
                counter.textContent = quantity;
                card.style.position = 'relative';
                card.appendChild(counter);
            }
        }

        function updateProductIndicators() {
            // Reset all product cards
            document.querySelectorAll('.product-card').forEach(card => {
                card.classList.remove('selected');
                // Remove existing counters
                const existingCounter = card.querySelector('.product-counter');
                if (existingCounter) {
                    existingCounter.remove();
                }
            });

            // Update baskets
            selections.baskets.forEach(basket => {
                const basketCard = document.querySelector(`[data-type="basket"][data-product="${basket.name}"]`);
                if (basketCard) {
                    basketCard.classList.add('selected');
                    if (basket.quantity > 1) {
                        updateBasketCounter(basketCard, basket.quantity);
                    }
                }
            });

            // Update items
            selections.items.forEach(item => {
                // Find card by exact name match for items
                const itemCards = document.querySelectorAll('[data-type="item"]');
                itemCards.forEach(card => {
                    if (card.dataset.product === item.name || item.name.includes(card.dataset.product)) {
                        card.classList.add('selected');
                        if (item.quantity > 1) {
                            updateProductCounter(card, item.quantity);
                        }
                    }
                });
            });

            // Update nets
            selections.nets.forEach(net => {
                const netCard = document.querySelector(`[data-type="net"][data-product="${net.name}"]`);
                if (netCard) {
                    netCard.classList.add('selected');
                    if (net.quantity > 1) {
                        updateProductCounter(netCard, net.quantity);
                    }
                }
            });

            // Update ribbons
            selections.ribbons.forEach(ribbon => {
                const ribbonCard = document.querySelector(`[data-type="ribbon"][data-product="${ribbon.name}"]`);
                if (ribbonCard) {
                    ribbonCard.classList.add('selected');
                    if (ribbon.quantity > 1) {
                        updateProductCounter(ribbonCard, ribbon.quantity);
                    }
                }
            });
        }

        function updateProductCounter(card, quantity) {
            // Remove existing counter
            const existingCounter = card.querySelector('.product-counter');
            if (existingCounter) {
                existingCounter.remove();
            }
            
            // Add new counter if quantity > 1
            if (quantity > 1) {
                const counter = document.createElement('div');
                counter.className = 'product-counter';
                counter.textContent = quantity;
                card.style.position = 'relative';
                card.appendChild(counter);
            }
        }

        function removeBasket(basketId) {
            const basketIndex = selections.baskets.findIndex(basket => basket.id == basketId);
            if (basketIndex !== -1) {
                const removedBasket = selections.baskets[basketIndex];
                selections.baskets.splice(basketIndex, 1);
                updateCart();
                
                // Show removal message
                showBasketRemovedMessage(removedBasket.name);
            }
        }

        function showBasketRemovedMessage(productName) {
            const message = document.createElement('div');
            message.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: white;
                color: #374151;
                border: 1px solid #e5e7eb;
                padding: 12px 20px;
                border-radius: 8px;
                font-weight: 600;
                z-index: 10000;
                animation: slideInRight 0.3s ease-out;
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            `;
            message.textContent = `âœ— ${productName} removed from cart`;
            
            document.body.appendChild(message);
            
            setTimeout(() => {
                message.style.animation = 'slideInRight 0.3s ease-out reverse';
                setTimeout(() => {
                    if (message.parentNode) {
                        message.parentNode.removeChild(message);
                    }
                }, 300);
            }, 2000);
        }

        // Net quantity and removal functions
        function changeNetQuantity(netId, delta) {
            const net = selections.nets.find(net => net.id == netId);
            if (net) {
                const newQty = net.quantity + delta;
                if (newQty <= 0) {
                    // Remove net if quantity would be 0
                    removeNet(netId);
                } else {
                    net.quantity = newQty;
                    updateCart();
                }
            }
        }

        function removeNet(netId) {
            const netIndex = selections.nets.findIndex(net => net.id == netId);
            if (netIndex !== -1) {
                const removedNet = selections.nets[netIndex];
                selections.nets.splice(netIndex, 1);
                updateCart();
                showItemRemovedMessage(removedNet.name, 'net');
            }
        }

        // Ribbon quantity and removal functions
        function changeRibbonQuantity(ribbonId, delta) {
            const ribbon = selections.ribbons.find(ribbon => ribbon.id == ribbonId);
            if (ribbon) {
                const newQty = ribbon.quantity + delta;
                if (newQty <= 0) {
                    // Remove ribbon if quantity would be 0
                    removeRibbon(ribbonId);
                } else {
                    ribbon.quantity = newQty;
                    updateCart();
                }
            }
        }

        function removeRibbon(ribbonId) {
            const ribbonIndex = selections.ribbons.findIndex(ribbon => ribbon.id == ribbonId);
            if (ribbonIndex !== -1) {
                const removedRibbon = selections.ribbons[ribbonIndex];
                selections.ribbons.splice(ribbonIndex, 1);
                updateCart();
                showItemRemovedMessage(removedRibbon.name, 'ribbon');
            }
        }

        // Generic message functions
        function showItemAddedMessage(productName, itemType) {
            const message = document.createElement('div');
            message.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #DAA520;
                color: white;
                padding: 12px 20px;
                border-radius: 8px;
                font-weight: 600;
                z-index: 10000;
                animation: slideInRight 0.3s ease-out;
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            `;
            message.textContent = `âœ“ ${productName} ${itemType} added to cart!`;
            
            document.body.appendChild(message);
            
            setTimeout(() => {
                message.style.animation = 'slideInRight 0.3s ease-out reverse';
                setTimeout(() => {
                    if (message.parentNode) {
                        message.parentNode.removeChild(message);
                    }
                }, 300);
            }, 2000);
        }

        function showItemRemovedMessage(productName, itemType) {
            const message = document.createElement('div');
            message.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: white;
                color: #374151;
                border: 1px solid #e5e7eb;
                padding: 12px 20px;
                border-radius: 8px;
                font-weight: 600;
                z-index: 10000;
                animation: slideInRight 0.3s ease-out;
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            `;
            message.textContent = `âœ— ${productName} ${itemType} removed from cart`;
            
            document.body.appendChild(message);
            
            setTimeout(() => {
                message.style.animation = 'slideInRight 0.3s ease-out reverse';
                setTimeout(() => {
                    if (message.parentNode) {
                        message.parentNode.removeChild(message);
                    }
                }, 300);
            }, 2000);
        }

        function updateItemCounter(card, quantity) {
            // Remove existing counter
            const existingCounter = card.querySelector('.basket-counter');
            if (existingCounter) {
                existingCounter.remove();
            }
            
            // Add new counter if quantity > 1
            if (quantity > 1) {
                const counter = document.createElement('div');
                counter.className = 'basket-counter';
                counter.textContent = quantity;
                card.style.position = 'relative';
                card.appendChild(counter);
            }
        }

        function calculateDiscount(subtotal) {
            let discountPercentage = 0;
            
            if (subtotal >= 50000) {
                discountPercentage = 25;
            } else if (subtotal >= 20000) {
                discountPercentage = 20;
            } else if (subtotal < 20000 && subtotal > 0) {
                discountPercentage = 15;
            }
            
            const discountAmount = Math.round((subtotal * discountPercentage) / 100);
            return { percentage: discountPercentage, amount: discountAmount };
        }

        function updateCart() {
            let subtotal = 0;

            // Baskets
            if (selections.baskets.length > 0) {
                document.getElementById('cartBaskets').style.display = 'block';
                let basketsHTML = '';
                selections.baskets.forEach(basket => {
                    const basketTotal = basket.price * basket.quantity;
                    basketsHTML += `
                        <div class="cart-item">
                            <img src="${basket.image}" class="cart-item-image">
                            <div class="cart-item-info">
                                <div class="cart-item-name">${basket.name}</div>
                                <div class="cart-item-price">â‚¹${basket.price} each</div>
                                <div class="quantity-controls">
                                    <button class="quantity-btn" onclick="changeBasketQuantity('${basket.id}', -1)" title="${basket.quantity === 1 ? 'Remove basket' : 'Decrease quantity'}">-</button>
                                    <span class="quantity-display">${basket.quantity}</span>
                                    <button class="quantity-btn" onclick="changeBasketQuantity('${basket.id}', 1)">+</button>
                                </div>
                            </div>
                            <div class="cart-item-total">â‚¹${basketTotal}</div>
                        </div>
                    `;
                    subtotal += basketTotal;
                });
                document.getElementById('cartBasketsContent').innerHTML = basketsHTML;
            } else {
                document.getElementById('cartBaskets').style.display = 'none';
            }

            // Items
            if (selections.items.length > 0) {
                document.getElementById('cartItems').style.display = 'block';
                let itemsHTML = '';
                selections.items.forEach(item => {
                    const itemTotal = item.price * item.quantity;
                    itemsHTML += `
                        <div class="cart-item">
                            <img src="${item.image}" class="cart-item-image">
                            <div class="cart-item-info">
                                <div class="cart-item-name">${item.name}</div>
                                <div class="cart-item-price">â‚¹${item.price} each</div>
                                <div class="quantity-controls">
                                    <button class="quantity-btn" onclick="changeItemQuantity('${item.id}', -1)" title="${item.quantity === 1 ? 'Remove item' : 'Decrease quantity'}">-</button>
                                    <span class="quantity-display">${item.quantity}</span>
                                    <button class="quantity-btn" onclick="changeItemQuantity('${item.id}', 1)">+</button>
                                </div>
                            </div>
                            <div class="cart-item-total">â‚¹${itemTotal}</div>
                        </div>
                    `;
                    subtotal += itemTotal;
                });
                document.getElementById('cartItemsContent').innerHTML = itemsHTML;
            } else {
                document.getElementById('cartItems').style.display = 'none';
            }

            // Nets
            if (selections.nets.length > 0) {
                document.getElementById('cartNets').style.display = 'block';
                let netsHTML = '';
                selections.nets.forEach(net => {
                    const netTotal = net.price * net.quantity;
                    netsHTML += `
                        <div class="cart-item">
                            <img src="${net.image}" class="cart-item-image">
                            <div class="cart-item-info">
                                <div class="cart-item-name">${net.name}</div>
                                <div class="cart-item-price">â‚¹${net.price} each</div>
                                <div class="quantity-controls">
                                    <button class="quantity-btn" onclick="changeNetQuantity('${net.id}', -1)" title="${net.quantity === 1 ? 'Remove net' : 'Decrease quantity'}">-</button>
                                    <span class="quantity-display">${net.quantity}</span>
                                    <button class="quantity-btn" onclick="changeNetQuantity('${net.id}', 1)">+</button>
                                </div>
                            </div>
                            <div class="cart-item-total">â‚¹${netTotal}</div>
                        </div>
                    `;
                    subtotal += netTotal;
                });
                document.getElementById('cartNetsContent').innerHTML = netsHTML;
            } else {
                document.getElementById('cartNets').style.display = 'none';
            }

            // Ribbons
            if (selections.ribbons.length > 0) {
                document.getElementById('cartRibbons').style.display = 'block';
                let ribbonsHTML = '';
                selections.ribbons.forEach(ribbon => {
                    const ribbonTotal = ribbon.price * ribbon.quantity;
                    ribbonsHTML += `
                        <div class="cart-item">
                            <img src="${ribbon.image}" class="cart-item-image">
                            <div class="cart-item-info">
                                <div class="cart-item-name">${ribbon.name}</div>
                                <div class="cart-item-price">â‚¹${ribbon.price} each</div>
                                <div class="quantity-controls">
                                    <button class="quantity-btn" onclick="changeRibbonQuantity('${ribbon.id}', -1)" title="${ribbon.quantity === 1 ? 'Remove ribbon' : 'Decrease quantity'}">-</button>
                                    <span class="quantity-display">${ribbon.quantity}</span>
                                    <button class="quantity-btn" onclick="changeRibbonQuantity('${ribbon.id}', 1)">+</button>
                                </div>
                            </div>
                            <div class="cart-item-total">â‚¹${ribbonTotal}</div>
                        </div>
                    `;
                    subtotal += ribbonTotal;
                });
                document.getElementById('cartRibbonsContent').innerHTML = ribbonsHTML;
            } else {
                document.getElementById('cartRibbons').style.display = 'none';
            }

            // Calculate discount and final total
            const discount = calculateDiscount(subtotal);
            const finalTotal = subtotal - discount.amount;

            // Update subtotal
            document.getElementById('cartSubtotal').textContent = `â‚¹${subtotal}`;

            // Update discount display
            const discountRow = document.getElementById('cartDiscountRow');
            if (discount.percentage > 0) {
                discountRow.style.display = 'flex';
                document.getElementById('cartDiscountLabel').textContent = `Discount (${discount.percentage}%)`;
                document.getElementById('cartDiscountAmount').textContent = `-â‚¹${discount.amount}`;
            } else {
                discountRow.style.display = 'none';
            }

            // Update final total
            document.getElementById('cartTotal').textContent = `â‚¹${finalTotal}`;
            
            // Update cart buttons state
            updateCartButtons();
            
            // Update summary if we're on the summary page (step 4)
            if (currentStep === 4) {
                updateSummary();
            }
        }

        // Go to Top functionality
        function scrollToTop() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }

        // Show/hide go-to-top button based on scroll position
        function toggleGoToTopButton() {
            const goToTopBtn = document.getElementById('goToTopBtn');
            if (window.pageYOffset > 300) {
                goToTopBtn.classList.add('visible');
            } else {
                goToTopBtn.classList.remove('visible');
            }
        }

        // Scroll detection for category titles
        let scrollTimeout;
        function initializeScrollDetection() {
            const sections = [
                { id: 'dates-section', category: 'dates' },
                { id: 'nuts-section', category: 'nuts' },
                { id: 'chips-section', category: 'chips' },
                { id: 'gifting-section', category: 'gifting' }
            ];
            
            function detectCurrentSection() {
                const scrollPosition = window.scrollY + window.innerHeight / 3;
                
                for (let i = sections.length - 1; i >= 0; i--) {
                    const element = document.getElementById(sections[i].id);
                    if (element && element.offsetTop <= scrollPosition) {

                        
                        // Update active filter tab
                        document.querySelectorAll('.filter-tab').forEach(tab => {
                            tab.classList.toggle('active', tab.dataset.filter === sections[i].category);
                        });
                        
                        break;
                    }
                }
            }
            
            window.addEventListener('scroll', () => {
                clearTimeout(scrollTimeout);
                scrollTimeout = setTimeout(detectCurrentSection, 50);
            });
            
            // Initial detection
            setTimeout(detectCurrentSection, 100);
        }

        // Add scroll event listener
        window.addEventListener('scroll', toggleGoToTopButton);

        function nextStep() {
            if (currentStep < 4) {
                // Check if cart is empty on first step
                if (currentStep === 0) {
                    const hasItems = selections.items && selections.items.length > 0;
                    if (!hasItems) {
                        alert('ðŸ§º Your basket is still empty! Please add some delicious items first.');
                        return;
                    }
                }
                
                // Trigger fill animation for current step before moving to next
                triggerStepCompletion(currentStep);
                
                // Validation
                if (currentStep === 1 && selections.baskets.length === 0) {
                    alert('Please select a basket');
                    return;
                }
                
                currentStep++;
                showStep(currentStep);
                updateCartButtons();
            } else if (currentStep === 4) {
                // Final step - place order
                placeOrder();
            }
        }

        function prevStep() {
            if (currentStep > 0) {
                currentStep--;
                showStep(currentStep);
                updateCartButtons();
            }
        }

        function showStep(stepIndex) {
            document.querySelectorAll('.step-content').forEach(step => {
                step.classList.remove('active');
            });
            
            document.querySelector(`.step-content[data-step="${stepIndex}"]`).classList.add('active');
            
            // Update summary if on last step
            if (stepIndex === 4) {
            updateSummary();
            updateProductIndicators();
        }            // Apply gradient animation to current step heading
            applyGradientToCurrentStep(stepIndex);
            

            
            updateProgress();
            updateCartButtons();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function goToStep(stepNumber) {
            if (stepNumber >= 0 && stepNumber <= 4) {
                currentStep = stepNumber;
                showStep(currentStep);
                updateProgress();
            }
        }

        function updateProgress() {
            document.querySelectorAll('.progress-step').forEach((step, index) => {
                step.classList.remove('active', 'completed');
                if (index === currentStep) {
                    step.classList.add('active');
                } else if (index < currentStep) {
                    step.classList.add('completed');
                }
            });
        }

        function triggerStepCompletion(stepIndex) {
            const progressSteps = document.querySelectorAll('.progress-step');
            if (progressSteps[stepIndex]) {
                setTimeout(() => {
                    progressSteps[stepIndex].classList.add('fill-animate');
                }, 200);
            }
        }

        function updateCartButtons() {
            const nextBtn = document.getElementById('cartNextBtn');
            const backBtn = document.getElementById('cartBackBtn');
            const emptyMessage = document.getElementById('emptyCartMessage');
            
            // Check if cart is empty
            const hasItems = selections.items && selections.items.length > 0;
            const hasBaskets = selections.baskets && selections.baskets.length > 0;
            const hasNets = selections.nets && selections.nets.length > 0;
            const hasRibbons = selections.ribbons && selections.ribbons.length > 0;
            
            const cartHasContent = hasItems || hasBaskets || hasNets || hasRibbons;
            
            // Show/hide empty cart message
            if (cartHasContent) {
                emptyMessage.style.display = 'none';
            } else {
                emptyMessage.style.display = 'block';
            }
            
            // Show/hide back button
            if (currentStep === 0) {
                backBtn.style.display = 'none';
            } else {
                backBtn.style.display = 'block';
            }
            
            // Disable next button if cart is empty (except on first step)
            if (!cartHasContent && currentStep === 0) {
                nextBtn.disabled = true;
                nextBtn.textContent = 'Add items first!';
            } else {
                nextBtn.disabled = false;
                // Update next button text for final step
                if (currentStep === 4) {
                    nextBtn.textContent = 'Place Order';
                    nextBtn.style.background = 'linear-gradient(135deg, #DAA520 0%, #B8860B 100%)';
                } else {
                    nextBtn.textContent = 'Next';
                    nextBtn.style.background = 'linear-gradient(135deg, #DAA520 0%, #B8860B 100%)';
                }
            }
        }

        function updateSummary() {
            let subtotal = 0;

            // Create the visual arrangement
            let arrangementHTML = '';
            let basketImage = '';
            let allItems = [];

            // Collect basket
            if (selections.baskets.length > 0) {
                basketImage = selections.baskets[0].image; // Use first basket image
                selections.baskets.forEach(basket => {
                    subtotal += basket.price * basket.quantity;
                });
            }

            // Collect all items (items, nets, ribbons)
            selections.items.forEach(item => {
                const itemTotal = (item.price * item.quantity);
                for(let i = 0; i < item.quantity; i++) {
                    allItems.push({ 
                        image: item.image, 
                        price: item.price, 
                        productName: item.name 
                    });
                }
                subtotal += itemTotal;
            });

            // Collect all nets
            selections.nets.forEach(net => {
                const netTotal = (net.price * net.quantity);
                for(let i = 0; i < net.quantity; i++) {
                    allItems.push({ 
                        image: net.image, 
                        price: net.price, 
                        productName: net.name 
                    });
                }
                subtotal += netTotal;
            });

            // Collect all ribbons
            selections.ribbons.forEach(ribbon => {
                const ribbonTotal = (ribbon.price * ribbon.quantity);
                for(let i = 0; i < ribbon.quantity; i++) {
                    allItems.push({ 
                        image: ribbon.image, 
                        price: ribbon.price, 
                        productName: ribbon.name 
                    });
                }
                subtotal += ribbonTotal;
            });

            // Calculate discount and final total
            const discount = calculateDiscount(subtotal);
            const finalTotal = subtotal - discount.amount;

            // Create simple arrangement with basket and semicircle of items
            if (basketImage || allItems.length > 0) {
                arrangementHTML = `
                    <div class="basket-arrangement">
                        <img src="${basketImage || 'logo.png'}" alt="Selected Basket" class="center-basket" onclick="openBasketTooltip()">
                        <div class="circular-items">
                `;

                // Position items in full semicircle arc above the basket
                allItems.forEach((item, index) => {
                    const totalItems = allItems.length;
                    let angle;
                    
                    if (totalItems === 1) {
                        angle = 90; // Single item at center top (90 degrees)
                    } else {
                        // Create full semicircle from 0Â° to 180Â° (left to right)
                        const startAngle = 180; // Start from left (180Â°)
                        const endAngle = 0;     // End at right (0Â°)
                        angle = startAngle - ((180 * index) / (totalItems - 1));
                    }
                    
                    const radius = 120; // Distance from basket center
                    const x = Math.cos(angle * Math.PI / 180) * radius;
                    const y = Math.sin(angle * Math.PI / 180) * radius;
                    
                    arrangementHTML += `
                        <img src="${item.image}" alt="Item" class="item-circle" 
                             style="left: calc(50% + ${x}px - 78px); top: calc(50% - ${y}px - 78px);"
                             onclick="openItemTooltip('${item.productName}', '${item.image}')">
                    `;
                });

                arrangementHTML += `
                        </div>
                    </div>
                `;

                // Add pricing summary below the arrangement
                arrangementHTML += `
                    <div class="summary-totals">
                        <div class="total-row">
                            <span>Subtotal:</span>
                            <span>â‚¹${subtotal}</span>
                        </div>`;

                if (discount.percentage > 0) {
                    arrangementHTML += `
                        <div class="total-row discount-row">
                            <span>Discount (${discount.percentage}%):</span>
                            <span>-â‚¹${discount.amount}</span>
                        </div>`;
                }

                arrangementHTML += `
                        <div class="final-total">
                            <span>Total Amount:</span>
                            <span>â‚¹${finalTotal}</span>
                        </div>
                    </div>
                `;
            }

            // Update the summary sections
            document.getElementById('basketSummary').innerHTML = arrangementHTML;
            document.getElementById('itemsSummary').innerHTML = '';
            document.getElementById('netSummary').innerHTML = '';
            document.getElementById('ribbonSummary').innerHTML = '';
        }

        // Functions to open tooltips from summary page circles
        function openBasketTooltip() {
            if (selections.baskets.length === 0) return;
            
            // Create a mock product card for the basket
            const mockCard = {
                dataset: {
                    product: selections.baskets[0].name,
                    price: selections.baskets[0].price,
                    type: 'basket',
                    category: 'basket'
                },
                querySelector: () => ({ src: selections.baskets[0].image })
            };
            
            showBasketInfo(mockCard);
        }
        
        function openItemTooltip(productName, imageSrc) {
            // Get base product name (remove variant info)
            const baseProductName = productName.includes('(') ? productName.split('(')[0].trim() : productName;
            const data = productData[baseProductName];
            
            if (data) {
                // Show tooltip for item with variants hidden for summary page
                showSummaryItemTooltip(baseProductName, imageSrc, data);
            } else {
                // For items without variant data (net, ribbon), show basic info
                showBasicInfo(productName, imageSrc);
            }
        }
        
        function showSummaryItemTooltip(productName, imageSrc, data) {
            currentTooltipProduct = {
                name: productName,
                image: imageSrc,
                type: 'item',
                data: data
            };

            // Set tooltip content
            document.getElementById('tooltipTitle').textContent = productName;
            document.getElementById('tooltipDescription').innerHTML = data.description.replace(/\n/g, '<br>');
            
            // Initialize image carousel with all product images
            initializeImageCarousel(data.images || [imageSrc]);

            // Hide variants section for summary page
            document.getElementById('tooltipVariants').style.display = 'none';
            
            // Show price from the first variant or selected item
            const selectedItem = selections.items.find(item => item.name.includes(productName));
            const price = selectedItem ? selectedItem.price : (data.variants[0] ? data.variants[0].price : 0);
            document.getElementById('tooltipPrice').textContent = `â‚¹${price}`;

            // Hide add button since item is already selected
            document.getElementById('addToBasketBtn').style.display = 'none';

            // Show tooltip
            document.getElementById('tooltipOverlay').classList.add('visible');
            setTimeout(() => {
                document.getElementById('productTooltip').classList.add('visible');
            }, 50);
        }
        
        function showBasketInfo(card) {
            currentTooltipProduct = {
                name: card.dataset.product,
                price: card.dataset.price,
                image: card.querySelector('.product-image') ? card.querySelector('.product-image').src : (selections.baskets.length > 0 ? selections.baskets[0].image : ''),
                type: 'basket'
            };

            // Set tooltip content
            document.getElementById('tooltipTitle').textContent = selections.baskets[0].name;
            document.getElementById('tooltipDescription').textContent = `Beautiful ${selections.baskets[0].name.toLowerCase()} perfect for creating memorable gift presentations.`;
            
            // Initialize with basket image
            initializeImageCarousel([selections.baskets[0].image]);

            // Hide variants section
            document.getElementById('tooltipVariants').style.display = 'none';
            document.getElementById('tooltipPrice').textContent = `â‚¹${selections.baskets[0].price}`;

            // Hide add button since basket is already selected
            document.getElementById('addToBasketBtn').style.display = 'none';

            // Show tooltip
            document.getElementById('tooltipOverlay').classList.add('visible');
            setTimeout(() => {
                document.getElementById('productTooltip').classList.add('visible');
            }, 50);
        }
        
        function showBasicInfo(productName, imageSrc) {
            // Set tooltip content for basic items (net, ribbon)
            document.getElementById('tooltipTitle').textContent = productName;
            document.getElementById('tooltipDescription').textContent = `Selected ${productName.toLowerCase()} for your gift basket.`;
            
            // Initialize with item image
            initializeImageCarousel([imageSrc]);

            // Hide variants section
            document.getElementById('tooltipVariants').style.display = 'none';
            
            // Find price from selections
            let price = 0;
            if (selections.net && selections.net.name === productName) {
                price = selections.net.price;
            } else if (selections.ribbon && selections.ribbon.name === productName) {
                price = selections.ribbon.price;
            }
            
            document.getElementById('tooltipPrice').textContent = `â‚¹${price}`;

            // Hide add button since item is already selected
            document.getElementById('addToBasketBtn').style.display = 'none';

            // Show tooltip
            document.getElementById('tooltipOverlay').classList.add('visible');
            setTimeout(() => {
                document.getElementById('productTooltip').classList.add('visible');
            }, 50);
        }





        // Initialize cart buttons and animations on page load
        updateCartButtons();
        updateProgress();
        initializeAnimations();
        
        // Set username in cart title
        updateCartTitle();
        
        // Navigate to dates category by default on page load
        navigateToCategory('dates');

        function initializeAnimations() {
            // Start gradient animation for current step heading after a short delay
            setTimeout(() => {
                applyGradientToCurrentStep(currentStep);
            }, 300);
        }

        function applyGradientToCurrentStep(stepIndex) {
            // Remove gradient from all headings first
            document.querySelectorAll('.step-heading').forEach(heading => {
                heading.classList.remove('gradient-animate');
            });
            
            // Add gradient to current step heading
            const currentHeading = document.getElementById(`step${stepIndex + 1}Heading`);
            if (currentHeading) {
                setTimeout(() => {
                    currentHeading.classList.add('gradient-animate');
                }, 200);
            }
        }

        function updateCartTitle() {
            // Get username from localStorage
            const userName = localStorage.getItem('userName') || 'Guest';
            
            // Convert to proper title case (first letter of each word capitalized)
            const titleCaseName = userName.toLowerCase().replace(/\b\w/g, l => l.toUpperCase());
            
            // Update cart title with formatted username
            const cartTitle = document.getElementById('cartTitle');
            if (cartTitle) {
                cartTitle.textContent = `${titleCaseName}'s gift basket`;
            }
        }

        // Place Order functionality with loading popup
        function placeOrder() {
            if (window.cartHandler) {
                const cartData = window.cartHandler.extractCartData();
                if (cartData && cartData.items.length > 0) {
                    // Show loading popup
                    showLoadingPopup();
                    
                    // Store order data for confirmation page
                    localStorage.setItem('lastOrder', JSON.stringify(cartData));
                    
                    // Start progress simulation
                    simulateProgress();
                    
                    // Save to Google Sheets
                    window.cartHandler.submitCartToSheets(cartData);
                    
                    // Wait 5 seconds to ensure data is saved, then redirect
                    setTimeout(() => {
                        updateLoadingStatus('Order saved successfully!', 100);
                        setTimeout(() => {
                            hideLoadingPopup();
                            window.location.href = 'order-confirmation.html';
                        }, 1500); // Show success message for 1.5 seconds
                    }, 5000); // Wait 5 seconds
                    
                } else {
                    alert('âš ï¸ Your basket is empty! Please add some items before placing your order.');
                }
            } else {
                console.error('Cart handler not loaded');
                alert('âŒ There was a technical issue. Please try again or contact support.');
            }
        }

        // Loading popup functions
        function showLoadingPopup() {
            const overlay = document.getElementById('loadingOverlay');
            const popup = document.getElementById('loadingPopup');
            
            if (overlay && popup) {
                overlay.classList.add('visible');
                popup.classList.add('visible');
            }
        }

        function hideLoadingPopup() {
            const overlay = document.getElementById('loadingOverlay');
            const popup = document.getElementById('loadingPopup');
            
            if (overlay && popup) {
                overlay.classList.remove('visible');
                popup.classList.remove('visible');
            }
        }

        function updateLoadingStatus(message, progress) {
            const statusElement = document.getElementById('loadingStatus');
            const progressBar = document.getElementById('loadingProgressBar');
            
            if (statusElement) {
                statusElement.textContent = message;
            }
            if (progressBar) {
                progressBar.style.width = progress + '%';
            }
        }

        function simulateProgress() {
            let progress = 0;
            const messages = [
                'Processing your order...',
                'Saving basket details...',
                'Finalizing your order...',
                'Almost done...'
            ];
            
            const interval = setInterval(() => {
                progress += Math.random() * 15 + 5; // Random progress between 5-20%
                if (progress > 90) progress = 90; // Cap at 90% until actual completion
                
                const messageIndex = Math.floor((progress / 90) * (messages.length - 1));
                updateLoadingStatus(messages[messageIndex], progress);
                
                if (progress >= 90) {
                    clearInterval(interval);
                }
            }, 1500); // Update every 1.5 seconds
        }

        // Cart saving functionality (kept for backup)
        function saveCartToSheets() {
            if (window.cartHandler) {
                window.cartHandler.saveCart();
            } else {
                console.error('Cart handler not loaded');
            }
        }

        // Auto-save cart when items are added/removed (optional)
        function autoSaveCart() {
            // Debounced auto-save to avoid too many requests
            clearTimeout(window.autoSaveTimeout);
            window.autoSaveTimeout = setTimeout(() => {
                const cartData = window.cartHandler?.extractCartData();
                if (cartData && cartData.items.length > 0) {
                    console.log('Auto-saving cart...', cartData);
                    window.cartHandler?.submitCartToSheets(cartData);
                }
            }, 2000); // Save 2 seconds after last change
        }

        // Override the original addToCart function to include auto-save
        const originalAddToCart = window.addToCart;
        window.addToCart = function(productId) {
            const result = originalAddToCart(productId);
            autoSaveCart(); // Auto-save after adding item
            return result;
        };

        // Override the original removeFromCart function to include auto-save
        const originalRemoveFromCart = window.removeFromCart;
        window.removeFromCart = function(productId) {
            const result = originalRemoveFromCart(productId);
            autoSaveCart(); // Auto-save after removing item
            return result;
        };
    </script>
</body>
</html>
